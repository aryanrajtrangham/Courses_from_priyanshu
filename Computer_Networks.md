# Computer Networks

## Syllabus

1. Fundamentals
2. Data link layer
3. Network layer
4. Transport layer
5. Application layer
6. Network Security

## Content

1. Fundamentals
2. Data Link Layer
3. Logical Addressing & Subnetting
4. Network Layer Protocols
5. Routing Protocols
6. NAT & IPv6
7. Transport Layer
8. Application Layer & Security

## Fundamentals

### Definition - Computer Network

- A computer network is a set of nodes connected by communication links
- A node can be a computer, printer or any other device capable of sending / receiving data generated by other nodes in the network
  - Example: computer, server, printer, security camera etc.
- A communication link can be wired link or wireless link. The link carries the information.
  - links:  wired : cable, wireless: air.

 End devices  | Intermediary devices
--------------|---------------------
 PC           | Router
 Printer      | Wireless Router
 Server       | Cell Tower
 Tablet       | Modem
 Smart Phone  | Internet card

### Basic characteristic of computer network

- Fault tolerance
  - The ability to:
    - Continue working despite failure
    - Ensure no loss of service
- Scalability
  - The ability to:
    - Grow based on the needs
    - Have good performance after growth
- Quality of Service (QoS)
  - The ability to:
    - Set Priorities
    - Manage data traffic to reduce data loss, delay etc
- Security
  - The ability to prevent:
    - Unauthorized access
    - Misuse
    - Forgery
  - The ability to provide:
    - Confidentiality
    - Integrity
    - Availability

### Network Protocols and Communication

- Data communication are the exchange of data between two nodes via some form of link (transmission medium) such as a cable.

- Data flow
  - Simplex:
    - Communication is unidirectional
    - One device can transmit and the other device will receive
    - Example: keyboards, traditional monitors.
  - Half duplex
    - Communication is in both directional but not at the same time.
    - If one device is sending, the other can only receive, and vice versa
    - Example: Walkie-talkies
  - Full duplex/ Duplex
    - Communication is in both directions simultaneously.
    - Device can send and receive at the same time.
    - Example: Telephone line.

- Protocols
  - All communication schemes will have the following things in common
    - Source or sender
    - Destination or receiver
    - Channel or media
  - Rules or protocols govern all methods of communication.
  - It is a set of rules that govern data communication.
  - Protocols determines
    - What is communicated ?
    - How it is communicated ?
    - When it is communicated ?
  - Protocols used in network communications also define
    - Message encoding
    - Message formatting and encapsulation
    - Message timing
    - Message size
    - Message delivery options
  - These are also known as elements of protocol
  - Message encoding

    ```[]
      Message ==> Encoder  ==> Transmitter ==> Transmitter ==> Receiver ==> Decoder  ==> Message
      Source      (Signal)                      Medium                      (Signal)    Destination
    ```

  - Message formatting and encapsulation
    - Agreed format
      - Encapsulation the information to identify the sender and the receiver rightly.
  - Message size
    - Humans break long messages into smaller parts or sentences.
    - Long messages must also be broken into smaller pieces to travel across a network.
  - Message Timing
    - Flow control
    - Response Timeout
  - Message delivery options
    - Unicast
    - Multicast
    - Broadcast

- Types of computer network
  - Peer-to-peer Network
    - No Centralized administration
    - All peers are equal
    - Simple sharing applications
    - Not scalable
  - Client Server Network (request-response model)
    - Centralized administration
    - Request-Response model
    - Scalable
    - Server may be overloaded

- Components of a computer network
  - Nodes
    - End nodes (End devices)
      - Computer
      - Network Printers
      - VoIP Phones
      - Telepresence endpoint
      - Security cameras
      - Mobile handheld devices (Smart phones, tablets, Personal Digital Assistance, Wireless debit/credit card reader, barcode scanner)
    - Intermediary nodes (intermediary devices)
      - Switches
      - Wireless access Point
      - Routers
      - Security Devices (Firewall)
      - Bridges
      - Hubs
      - Repeaters
      - Cell Tower
  - Media
    - Wired medium (Guided medium)
      - Ethernet straight-through cable (connects two devices of different kind)
      - Ethernet crossover cable (connects two devices of same kind)
      - Fiber optic cable
      - Coaxial cable
      - USB cable (Universal serial bus)
    - Wireless medium (unguided medium)
      - Infrared (Ex: short range communication - TV remote control)
      - Radio (Ex: Bluetooth, Wi-Fi)
      - Microwaves (Ex: Cellular System)
      - Satellite (Ex: long range communication - GPS)
  - Services
    - e-mail
    - storage services
    - file sharing
    - instant messaging
    - online game
    - VOIP (voice over IP)
    - video telephone
    - www (world wide web)

### Classification of Computer Network

- Local Area Network (LAN)
  - A local Area network (LAN) is a computer network that interconnects computer within a limited area such as a residence, school, laboratory, university campus or office building.
  - LAN devices :
    - Wired LAN (Ex: Ethernet- Hub, Switch)
    - Wireless LAN (Ex: Wi-Fi)

- Metropolitan Area network (MAN)
  - A metropolitan area network is a computer network that interconnects users with computer resources in a geographic region of the size of a metropolitan area (City).
  - MAN devices :
    - Switches/Hub
    - Router/Bridges

- Wide Area Network (WAN)
  - A wide area network (WAN) is a telecommunications network that extends over a large geographical area for the primary purpose of computer networking.
  - WAN devices :
    - End devices and intermediary devices

- New Trends
  - Bring your own device (BYOD)
  - Online collaboration
  - Cloud computing

- Storage Area network (SAN)
  - It is the on-demand availability of computer system resources, especially data storage and computing power, without direct active management by the user.
  - Google drive
  - Azure storage service

### Network Topology

- Arrangement of nodes of a computer network.
- Topology = Layout
  - Physical Topology - Placement of various nodes.
  - Logical Topology - Deals with the data flow in the network

- Bus topology
  - All data transmitted between nodes in the network is transmitted over this *common transmission medium* and is able to be received by all nodes in the network simultaneously.
  - A signal containing the address of the intended receiving machine travels from a source machine in *both direction* to all machines connected to the bus until it finds the intended recipient.
  - Advantages |  Disadvantages
    -----------|-----------------
    Only one wire - less expensive | Not fault tolerant (No redundancy)
    Suited for temporary network   | Limited cable length
    Node failure does not affect other | No security

- Ring topology (Token ring topology)
  - A ring topology is a bus topology in a closed loop.
  - Peer-to-peer LAN topology
  - Two connections: one to each of its nearest neighbours
  - Unidirectional
  - Sending and receiving data takes place with the help of a *TOKEN*.
  - Advantages |  Disadvantages
    -----------|-----------------
    Performance better than Bus topology | Unidirectional. Single point of failure will affect the whole network
     _ | More load decreases the performance
     _ | Can cause bottleneck due to weak links
    All nodes with equal access | No security

- Star topology
  - Every node is connected to a central node called a hub or switch
  - Centralized Management
  - All traffic must pass through the hub or switch
  - Advantages | Disadvantages
    -----------|----------------
    Easy to design and implement. | Single point of failure affects the whole network.
    Centralized administration. | Bottleneck due to overloaded switch/Hub.
    Scalable. | Increased cost due to switch/hub.
  - Two star topologies can be connected by a repeater.

- Mesh topology
  - Each node is directly connected to every other nodes in the network
  - Fault tolerant and reliable.
  - Advantages | Disadvantages
    -----------|----------------
    Fault tolerant. | Issues with broadcasting messages
    Reliable | Expensive and impractical for large networks

- Hybrid topology
  - It contains one or more topologies

### Basic of IP addressing

- IP Addressing
  - IP stands for Internet Protocol.
  - Every node in the computer network is identified with the help of IP address.

- IP Address (IPV4)
  - Every node in the computer network is identified with the help of IP address.
  - Logical address: We can change based on the location of the device.
  - Assigned by manually or dynamically.
  - Represented in decimal and it has 4 octets (x.x.x.x).
  - 0.0.0.0 to 255.255.255.255 (32 bits).

### Basics of MAC addressing

- MAC stands for Media Access Control.
- MAC address = Physical address
- Every node in the LAN is identified with the help of MAC address.
- IP Address = Location of a person
- MAC Address = Name of the person

- MAC Address
  - Every node in the LAN is identified with the help of MAC address
  - Physical address or Hardware Address
  - Unique, cannot be changed
  - Assigned by the manufacturer
  - Represented in hexadecimal
  - Example: 70-20-84-00-ED-FC (48 bits)
  - Separator: hyphen(-), period(.) and colon(:)

 IP address | MAC Address |
-----------|-------------
 Needed for communication. | Needed for communication.
 32 bits | 48 bits
 Represented in decimal. | Represented in hexadecimal.
 Router needs IP Address to forward data | Switch needs MAC address to forward data.
 Example : 10.10.23.56 | Example : 70-20-84-00-FD-FC

### Basics of Port addressing

- Derivations from analogy
  - Reaching our city = Reaching our network (IP address)
  - Reaching our Apartment = Reaching the host (MAC address)
  - Reaching the right person = Reaching the right process (Port address)

- Port Address or Port Numbers
  - In a node, many processes will be running
  - Data which are sent/received must reach the right process
  - Every process in a node is uniquely identified using port numbers
  - Port = Communication endpoint
  - Fixed port numbers and dynamic port numbers (0 - 65535)
  - Example :
    - Fixed port numbers: 25, 80 etc.
    - OS assigned dynamic port numbers: 62414.
  - Three key points : Before sending the data , any node must
    - Attach source IP address and destination IP address.
    - Attach source MAC address and destination MAC address.
    - Attach source port number and destination port number.

### Switching Techniques

- Switching in computer network helps in deciding the best route for data transmission if there are multiple path in a larger network
- One-to-One connection.
- Switching Techniques
  - Circuit Switching
    - A dedicated path is established between the sender and receiver.
    - Before data transfer, connection will be established
    - Example: Telephone network
    - 3 phase in circuit switching
      - Connection establishment
      - Data transfer
      - Connection disconnection

  - Message Switching
    - Store and forward mechanism
    - Message is transferred as a complete unit and forwarded using store and forward mechanism at the intermediary node.
    - Not suited for streaming media and real-time applications.

  - Packet Switching
    - The internet is a packet switch network.
    - Message is broken into individual chunks called as *packets*
    - Each packet is sent individually.
    - Each packet will have *source and destination IP address* with sequence number.
    - Sequence numbers help the receiver to -
      - Reorder the packets
      - Detect missing packets and
      - Send acknowledgments
    - Two approaches to packet switching
      - Datagram Approach
        - Datagram Packet Switching is also known as *connectionless switching*.
        - Each independent entity is called as datagram
        - Datagrams contain destination information and the intermediary device uses this information to forward datagrams to right destination.
        - In datagram Packet Switching approach, the path is not fixed.
        - Intermediate nodes take the routing decisions to forward the packets
      - Virtual Circuit Approach
        - Virtual Circuit Switching is also known as *connection-oriented switching*.
        - In the case of Virtual circuit switching, a pre-planned route is established before the messages are sent.
        - Call request and call accept packets are used to establish the connection between sender and receiver.
        - In this approach, the path is fixed for duration of a logical connection.

### Layering in Computer Networks

- Layering
  - Layering means decomposing the problem into more manageable components (layers).
  - Advantages :
    - It provides more modular design.
    - Easy to troubleshoot.

- Protocols
  - It is a set of rules that govern data communication.
  - The *protocols* in each layer governs the activities of the data communication.

- Layered Architectures
  - The OSI reference model
    - OSI = Open System Interconnection
    - It is a model for understanding and designing a network architecture that is flexible, robust and interoperable
    - Developed by the International Standards Organization (ISO)
    - The OSI model is not a *protocol*.
    - It is only a guideline and hence it is referred as OSI reference model.
    - The purpose of OSI model is to show how to facilitate communication between different systems without requiring changes to the logic of underlying hardware and software.
    - The OSI model was never fully implemented. (It's just a guideline)

  - The TCP/IP model
    - TCP/IP = Transmission Control Protocol/Internet Protocol.
    - The TCP/IP protocol suite was developed prior to the OSI model.
    - Therefore, the layers in the TCP/IP protocol suite do not exactly match those in the OSI model.
    - *TCP/IP is a hierarchical protocol* made up of interactive modules, each of which provides a specific functionality.

### The OSI Reference Model

- Layers

  ```[]
     Shortcut            Layers
    +------------+ +---------------------+
    | Away       | | Application Layer   |
    +------------+ +---------------------+
    | Pizza      | | Presentation Layer  |
    +------------+ +---------------------+
    | Sausage    | | Session Layer       |
    +------------+ +---------------------+
    | Throw      | | Transport Layer     |
    +------------+ +---------------------+
    | Not        | | Network Layer       |
    +------------+ +---------------------+
    | Do         | | Data Link Layer     |
    +------------+ +---------------------+
    | Please     | | Physical Layer      |
    +------------+ +---------------------+
  ```

- Physical communication

  ```[]
        Device A             intermediate node    intermediate node         Device B
          [_]                    (x)                  (x)                     [_]
          ===                     |                    |                      ===
           +----------------------+--------------------+------------------------+
    +-----------------+      Peer to peer protocol (7th layer)          +-----------------+
    7  Application    |<----------------------------------------------->|  Application    7
    +--7-6 interface--+      Peer to peer protocol (6th layer)          +--7-6 interface--+
    6  Presentation   |<----------------------------------------------->|  Presentation   6
    +--6-5 interface--+      Peer to peer protocol (5th layer)          +--6-5 interface--+
    5  Session        |<----------------------------------------------->|  Session        5
    +--5-4 interface--+      Peer to peer protocol (4th layer)          +--5-4 interface--+
    4  Transport      |<----------------------------------------------->|  Transport      4
    +--4-3 interface--+  3rd  +------------+  3rd  +------------+  3rd  +--4-3 interface--+
    3  Network        |<----->|  Network   |<----->|  Network   |<----->|  Network        3
    +--3-2 interface--+  2nd  +------------+  2nd  +------------+  2nd  +--3-2 interface--+
    2  Data Link      |<----->|  Data Link |<----->|  Data Link |<----->|  Data Link      2
    +--2-1 interface--+  1st  +------------+  1st  +------------+  1st  +--2-1 interface--+
    1  Physical       |<----->|  Physical  |<----->|  Physical  |<----->|  Physical       1
    +--------+--------+       +-----+------+       +-----+------+       +---------+-------+
             +----------------------+--------------------+------------------------+

  ```

- Application Layer
  - It enables the user to access the network resources.
  - Services provided by Application Layer
    - File Transfer and Access Management (FTAM).
    - Mail Services
    - Directory services

- Presentation Layer
  - It is concerned with the syntax and semantics of the information exchanged between two systems.
  - Services provided by Presentation Layer
    - Translation (Converting data into common format)
    - Encryption
    - Compression

- Session Layer
  - It establishes, maintains and synchronizes the interaction among communication devices
  - Services provided by Session Layer
    - Dialog control (determine one-way or multi-way)
    - Synchronization (fault tolerant)

- Transport Layer
  - It is responsible for process to process delivery of the entire message.
  - Services provided by Transport Layer
    - Port addressing
    - Segmentation and Reassembly
    - Connection Control (Connection-orient or connectionless-service)
    - End-to-End Flow Control
    - Error Control

- Network Layer
  - It is responsible for delivery of data from the original source to the destination network.
  - Services provided by Network Layer
    - Logical addressing (IP addressing)
    - Routing

- Data Link Layer
  - It is responsible for moving data (frames) from one node to another node.
  - Services provided by Data Link Layer
    - Framing
    - Physical Addressing
    - Flow Control
    - Error Control
    - Access Control

- Physical Layer
  - It is responsible for transmitting bits over a medium.
  - It also provides electrical and mechanical specifications.
  - Services provided by Physical Layer
    - Physical characteristics of the media
    - Representation of bits
    - Data rate
    - Synchronization of bits
    - Line configuration
    - Physical topology
    - Transmission mode (determine simplex or duplex)

- Service offered by each layer
  - Application Layer = FTAM, Mail Services & Directory Service
  - Presentation Layer = Translation, Encryption & Compression
  - Session Layer = Dialog Control & Synchronization
  - Transport Layer = Port addressing ,Segmentation & Reassembly, Connection Control, Flow control & Error Control.
  - Network Layer = Logical Addressing and Routing
  - Data Link Layer = Framing, Physical Addressing, Flow Control, Error Control & Access Control
  - Physical Layer = Physical characteristic of the media, Representation of bits, Data rate, Synchronization of bits, Line configuration, Physical topology & Transmission mode.

### Addressing in Networking

- IP Addressing and MAC Addressing :
  - Nodes put routers ip address and forward the packets
  - Router search with the help of mac address and then forward the packets
    - to destination node
    - by changing ip address to different routers

### The TCP/IP Protocol Suite

- Layers

  ```[]
      OSI Reference model      vs         TCP/IP model
    +---------------------+             +---------------------+
    | Application Layer   |  HTTP, DNS  |                     |
    +---------------------+  DHCP, FTP  |  Application Layer  |
    | Presentation Layer  |             |                     |
    +---------------------+             |                     |
    | Session Layer       |             |                     |
    +---------------------+             +---------------------+
    | Transport Layer     |  TCP, UDP   |  Transport Layer    |
    +---------------------+             +---------------------+
    | Network Layer       | IP, ICMPv6  |  Internet           |
    +---------------------+             +---------------------+
    | Data Link Layer     |  PPP,       |                     |
    +---------------------+ Frame Relay |  Network Access     |
    | Physical Layer      |  Ethernet   |       Layer         |
    +---------------------+             +---------------------+
  ```

- Protocol Data Unit (PDU)
  - Protocol Data Units (PDUs) are named according to the protocols of the TCP/IP suite: data, segment, packet, frame and bits.
    - Application Layer - Data
    - Transport Layer - Segment
    - Network Layer - Packet
    - Data Link Layer - Frame (hosts)
    - Physical Layer - Bit (adaptors)

### Basic Networking Commands

- ipconfig
- ipconfig/all
- nsloookup
- ping
- tracert

### Basics of Cisco Packet Tracer

- Cisco - The leader in networking
  - An innovative and powerful networking simulation tool used for practice, discovery and troubleshooting.
  - Helps understand networks practically.

- Hub a.k.a Network hub
  - Hub works at the physical layer of the OSI model.
  - Used to set up LAN
  - Has multiple ports
  - Star topology
  - When a packet arrives at one port, it's copied to the other ports so that all segments of the LAN can see all packets.
  - Pros
    - Cheaper than switches.
    - Works good for smaller network.
  - Cons
    - Issues with broadcast
    - No memory
    - Normally runs in half duplex mode.

- Switch = A switch is a networking hardware that connects devices on a computer network to establish a local area network.
  - Unlike hub, switch has memory.
  - Stores MAC address table.
  - Layer 2 device for setting up LAN.

 Hub                       | Switch
---------------------------|--------------------------------
 Layer 1 device            | Layer 2 device
 Works at physical layer   | Works at Data Link layer
 Has no memory             | Has memory and stores MAC address table
 Not an intelligent device | Intelligent device
 Floods the network due to broadcasting | Can do unicasting and broadcasting.
 Security risks are high.  | Security risks are low.
 Less efficient            | More efficient
 Half Duplex               | Full Duplex.

- Router = A router is a networking device that forwards data packets between computer networks.
  - A router is a connected to at least two networks, commonly two LANs or WANs or a LAN and its ISP network.
  - It is a layer 3 (Network layer) device.
  - Stores routing table.

 Switch                    | Router
---------------------------|----------------------------
 A network switch is a computer networking device that is used to connect many devices together on a computer network | A router is a networking device that connects a local network to other local networks.
 Operates at layer 2 (Data Link Layer) | Operates at layer 3 (Network Layer)
 Has memory and stores MAC address table | Has memory and stores Routing table.
 Decisions are taken based on MAC address | Decisions are taken based on IP address.
 Half / Full Duplex      | Full Duplex
 LAN                     | LAN,MAN & WAN

- Repeater
  - The data signals generally becomes too weak or corrupted if they tend travel a long distance
  - Repeater regenerates the signal over the same network.
  - It operated at the physical layer.
  - They do not amplify the signal.
  - It is a 2 port device.

### Basics of Bridge

- Bridge = Repeater + Functionality of reading MAC address.
- It is a layer 2 device.
- It's also used for interconnecting two LANs on the *same protocol*.
- It is also a two port device.
- Types of Bridges
  - Transparent Bridges
    - These are the bridges in which the stations are completely unaware of the bridge's existence.
    - Reconfiguration of the stations is unnecessary even if bridge is added or removed from network.
  - Source Routing Bridges
    - In these bridges, routing operation is performed by source station and the frame specifies which route to follow.

 Bridge                               | Router
--------------------------------------|-----------------------------------------------
 Bridge works in data link layer.     | Router works in network layer.
 Through bridge, data or information is not store and sent in the form of packet. | Through router, data or information is store and sent in the form of packet.
 There are only two ports in bridge.  | There are more than two ports in router.
 Bridge connects two different LANs.  | Router is used by LAN as well as MAN for connection.
 In bridge, routing table is not used.| In routers, routing table is used.
 Bridge works on single broadcast domain.| Router works on more than single broadcast domain.
 Bridges are easy to configure.       | Routers are difficult to setup and configure.
 Bridge focuses on MAC address .      | Router focuses on protocol address.
 Bridge is comparatively inexpensive. | Router is relatively expensive device.
 Bridges are good for segment network and extends the existing network.| Routers are good for joining remote networks.

### Network Devices

- List of various networking devices
  - Repeater <- Layer 1 device
  - Hub <- Layer 1 device
  - Switch <- Layer 2 device
  - Bridge <- Layer 2 device
  - Router <- Layer 3 device
  - Multi-layer switch (Layer 3 switch) <- Layer 3 device
  - Brouter (Bridge + router) <- Layer 2/3 device
  - Modem
  - Firewall (Security device)

### Physical Layer and Media

- Fundamental principles of Physical Layer
  - One of the major functions of the physical layer is to move data in the form of electromagnetic signals across a transmission medium.
  - The data usable to a person or an application are not in a form that can be transmitted over a network.
  - For example, an image must first be changed to a form that transmission media can accept.
  - To be transmitted, data must be transformed to electromagnetic signals.

- Signal
  - It is a function that represents the variation of a physical quantity with respect to time.
  - Example: Variation in temperature of a city in one day i.e. 24 hours.
  - Analog Signal
    - It is the signal that can take any value in the defined range.
    - All real-life signals are analog in nature
  - Digital Signal
    - It is the signal that can take on of the finite values at any given time.
    - In case of digital signals, we discretize both time and magnitude.
  - Comparison of various physical media

     Media        | Physical Component    | Signal
    --------------|-----------------------|----------
     Copper cable </br>(wired) | UTP/STP </br> Coaxial </br> Connectors </br> NICs </br> Ports/interfaces              | Electromagnetic Signal
     Fiber Optic </br> Cable </br> (Wired) | Single-mode Fiber </br> Multi-mode Fiber </br> Connectors   </br> Lasers and LEDs  | A light pulse equal 1 </br> No light pulse is 0.
     Wireless Media | Access Points </br> NICs </br> Radio </br> Antennae | Radio waves

- Wired Media
  - Copper cable (Ethernet cable)
    - Unshielded Twisted Pair (UTP)
      - CrossTalk
        - UTP cable does not use shielding to counter the effects of EMI and RFI.
        - The negative effect of crosstalk can be limited by varying the number of twists per wire pair.
    - Shielded Twisted Pair (STP)
  - Copper coaxial cable
  - Fiber optic cable
    - The cable transmit signal in the form of light waves
    - High Speed transmission.
  - Copper vs Fiber Optic Media
  
     Implementation Points     | Copper            | Fiber Optic
    ---------------------------|-------------------|-------------------
     Bandwidth Supported       | 10 Mbps - 10 Gbps | 10 Mbps - 100 Gbps
     Range | Relatively short (upto 100 meters) | Relatively high (upto 100,000 meters)
     Immunity to EMI and RFI   | Low            | High (Completely immune)
     Immunity to Electrical Hazards  | Low      | High (Completely immune)
     Media and Connector Costs | Lowest         | Highest
     Installation Skills Required | Lowest      | Highest
     Safety                    | Lowest         | Highest
  
- Wireless Media
  - Wireless media has the following areas of concern
    - Coverage area
    - Interference
    - Security
  - Wireless technologies
    - Wi fi
    - Bluetooth
    - Wi max

### Line Configuration

- In a network, two or more nodes are connected by a communication link.
- The communication link can be wired or wireless.
- For visualization purpose, links are imagined as a line drawn between two points.
- For communication to happen, two nodes must be connected to the same link at the same time.
- This is called as line configuration or *connection*.
- Types of Line Configuration
  - Point-to-point Connection
    - A point-to-point connection provides a dedicated link between two devices.
    - The entire capacity of the link is reserved for transmission between those two devices.
  - Multi-point Connection
    - It is also called Multi-drop configuration or Broadcast connection.
    - In this connection, two or more devices share a single link.
    - Since more than two devices share the link, the capacity of the channel shared is low.
    - It can be spatial or temporal.

## Data link layer

- It is responsible for moving data(frames) from one node to another node.

### Link Layer Services

- Framing
  - The data link layer needs to pack bits into frames, so that each frame is distinguishable from another.
  - Our postal system practices a type of framing.
  - The simple act of inserting a letter into an envelope separates one piece of information from another; the envelope serves as the delimiter.
- Physical Addressing
  - A frame is the encapsulation of header and trailer information with the packet.
  - In the header, the source and the destination MAC address are dealt.
- Flow Control
  - Flow Control is one of the duties of data link control sublayer.
  - The flow control in data link layer is end to end flow control.
  - Speed matching mechanism.
  - Flow control coordinates the amount of data that can be sent before receiving an acknowledgement.
- Access Control
  - Media access control
- Error Control
  - Error Detection
  - Error Correction

### Sublayers of the Data Link Layer

```[]
  +-------------------------------------------------------+
  |                   Network                             |
  +----------------+-----------------------+--------------+
  |                | LLC Sublayer          | IEEE 802.15  |
  | Data link      |                       | Bluetooth    |
  |                +-----------------------+--------------+
  |                | MAC sublayer          | IEEE 802.11  |
  |                |                       |   Wi-Fi      |
  +----------------+-----------------------+--------------+
  |       Physical                         | IEEE 802.3   |
  |                                        | Ethernet     |
  +----------------------------------------+--------------+
```

- LLC sublayer
  - Logical Link Control (LLC) or Data Link Control (DLC) sublayer
  - Handles communication between upper and lower layers.
  - Takes the network protocol data and adds control information to help deliver the packet to the destination. (Flow control)

- MAC sublayer
  - Constitutes the lower sublayer of the date link layer
  - Implemented by hardware, typically in the computer NIC.
  - Two primary responsibilities
    - Data encapsulation
      - Frame assembly before transmission and frame disassembly upon reception of a frame.
      - MAC layer adds a header and trailer to the network layer PDU.
      - Provides three primary functions
        - Framing
        - Physical Addressing or MAC Addressing.
        - Error control.
    - Media access control
      - Responsible for the placement of frames on the media and the removal of frames from the media.

### Framing

- Framing in the data link layer separates a frame distinguishable from another frame
- Frame = Header + Network Layer PDU + Trailer
- In packet switched network, the block of data called frames are exchanged between nodes, not bits streams.
- When node A wishes to transmit a frame to node B, it tells its adaptor to transmit a frame from the node's memory.
- This results in a sequence of bits being sent over the link.
- The adaptor on node B then collects together the sequence of bits arriving on the link and deposits the corresponding frame in B's memory.
- Types of Framing
  - Fixed-size framing
    - Here the size of the frame is fixed and so the frame length acts as delimiter of the frame.
    - Consequently, it does not require additional boundary bits to identify the start and end of the frame.
  - Variable-size framing
    - Here, the size of each frame to be transmitted may be different.
    - So additional mechanisms are kept to mark the end of one frame and the beginning of the next frame.
- Various framing Approaches
  - Bit Oriented
    - It simply views the frame as a collection of bits.
    - In bit-oriented framing, data is transmitted as a sequence of bits that can be interpreted in the upper layers both as text as well as multimedia data.
    - Bit Oriented Protocol
      - High-level Data Link Control (HDLC)
  - Byte Oriented
    - a.k.a Character Oriented Approach
    - One of the oldest approaches to framing.
    - Here each frame is viewed as a collection of bytes (characters) rather than bits.
    - Byte Oriented Protocols
      - Binary Synchronous Communication Protocol (BISYNC)
      - Digital Data Communication Message Protocol (DDCMP)
      - Point-to-point Protocol (PPP)
  - Clock Based Framing
    - The third approach to framing
    - Example = Synchronous Optical Network Protocol (SONET)

### High-level Data Link Control (HDLC)

- The Synchronous Data Link Control (SDLC) protocol developed by IBM is an example of a bit-oriented protocol.
- SDLC was later standardized by the ISO as the High-Level Data Link Control (HDLC) protocol.
- Bit-Oriented protocol
- HDLC - Frame Format
    8         | 16         | variable length | 16  | 8
  ------------|--------------|---------------|-----|------------
    Beginning </br> Sequence | Header | Body | CRC | Ending</br> Sequence
  - Beginning and Ending Sequences: 01111110
    - This sequence is also transmitted during any times that the link is idle so that the sender and receiver can keep their clocks synchronized.
  - Header : Address and Control Field.
  - Body : Payload (Variable size)
  - CRC : Cyclic Redundancy Check - Error Detection
- Types of HDLC Frames
  - The type of frame is determine by the control field.
    - I-Frame : Information Frame (1st bit is 0)
    - S-Frame : Supervisory Frame (1st two bits are 10)
    - U-Frame : Un-numbered Frame (1st two bits are 11)

- Bit Stuffing : Bit stuffing refers to the insertion of one or more bits into a data transmission as a way to provide signalling information to a receiver. The receiver knows how to detect, remove or disregard the stuffed bits.

### Binary Synchronous Communication Protocol (BSC/ BiSYNC)

- It is a sentinel approach.
- Developed by IBM
- Also referred as BSC.
- It is a byte-oriented protocol.
- BiSync - Frame Format
   8    | 8    | 8    |          | 8    | variable length | 8    | 16
  ------|------|------|----------|------|-----------------|------|------
   SYN  | SYN  | SOH  | Header   | STX  | Body            | ETX  | CRC
  - Frames transmitted beginning with leftmost field.
  - Beginning of a frame is denoted by sending a special SYN (synchronize) character.
  - Data portion of the frame is contained between special sentinel character STX (start of text) and ETX (end of text).
  - SOH : Start of Header.
  - DLE : Data Link Escape.
  - CRC : Cyclic Redundancy Check.

- Character Stuffing : Byte Stuffing or Character Stuffing is the process of adding one extra byte whenever there is a flag or escape character in the text.
  - This is done by data link escape(DLE) in BISYNC protocol.

### Point-to-Point Protocol (PPP)

- It is a byte-oriented protocol.
- PPP is a data-link layer protocol.
- PPP is a WAN protocol and which is commonly run over Internet links.
- It is widely used in broadband communications having heavy loads and high speeds.
- It is used to transmit multi-protocol data between two directly connected (point-to-point) computers.
- PPP - Frame Format
   8     | 8     | 8     | 8/16   |           | 16       | 8
  -------|-------|-------|--------|-----------|----------|------
   Flag  |Address|Control|Protocol| Payload   | Checksum | Flag
  - Flag : 1 byte that marks the beginning and the end of the frame. The bit pattern of the flag is 01111110.
  - Address : 1 byte which is set to 1111,1111 in case of broadcast.
  - Control : 1 byte set to a constant value of 11000000.
  - Protocol : 1 or 2 bytes that define the type of data contained in the payload field.
  - Payload : This carries the data from the network layer. The maximum length of the payload is 1500 bytes. However, this may be negotiated between the endpoints of communication.
  - Checksum : Error detection

- Character Stuffing : Byte stuffing or Character stuffing is the process of adding one extra byte whenever there is a flag sequence appearing in the payload.

### Digital Data Communication Message Protocol (DDCMP)

- It is a byte-oriented protocol.
- Devised by Digital Equipment Corporation.
- It is a byte-counting approach
- Count field in the frame format
  - Count : How many bytes are contained in the frame body?
- DDCMP - Frame Format
   8    | 8    | 8     | 14    | 42     | variable length | 16
  ------|------|-------|-------|--------|-----------------|-------
   SYN  | SYN  | Class | Count | Header | Body            | CRC
  - Danger with the count field
    - One danger with this approach is that if transmission error could corrupt the count field then the end of the frame would not be correctly detected by the receiver.

### Error Detection

- Error
  - Data are transmitted in the network.
  - The data can be corrupted during transmission.
  - Transmission error.
  - For reliable communication, errors must be detected and corrected.
  - Error detection and correction are implemented either at the data link layer or the transport layer of the OSI model.
  - Types of error
    - Bit Error (single bit error)
      - In a single bit error, only 1 bit in the data unit has been changed.
    - Burst Error
      - In burst error, 2 or more bits in the data unit have changed.
  - Error detection
    - Error detection means to decide whether the received data is correct or not without having a copy of the original message.
    - To detect or correct errors, we need to send some extra bits with the data.
    - The extra bits are called as redundant bits.
  - Redundancy

    ```[]
    +---------------------+            +------------------------+
    |        Data         |            |                        |
    |  101000000000010101 |            |                        |
    |          |          |            |       +-----> Accept   |
    |      generating     |            |  Checking              |
    |       function      |            |  function              |
    |          |          |            |       +-----> Reject   |
    |       1011101       |            |                        |
    |  Redundancy check   |            |             (Receiver) |
    +----------|----------+            +------------|-----------+
    sender     |      Data & redundancy check       |
               +-->[1011101] [101000000000010101]---+
    ```

  - Error Correction
    - It can be handled in two ways
      - Receiver can have the sender retransmit the entire data unit.
      - The receiver can use an error-correcting code, which automatically corrects certain errors.

    ```[]
      Sender
    +----------------------+                          +------------------------+
    |             Encoder  |                          |               Decoder  |
    |      Message         |                          |     Message            |
    |         |            |                          |        |    Correct or |
    |      Generator       |                          |     Checker    discard |
    |         |            | Unreliable transmission  |        |               |
    | Message & redundancy-|--------------------------|-> Received information |
    +----------------------+                          +------------------------+
    ```

  - Error Detection techniques
    - Four types of redundancy checks are used in data communications.
      - Vertical Redundancy Check (VRC)
      - Longitudinal Redundancy Check (LRC)
      - Checksum (Internet Checksum / Arithmetic Checksum)
      - Cyclic Redundancy Check (CRC)

### Vertical Redundancy Check (VRC)

- It's also called as parity check.
- Example

  ```[]
  Data   1100001 
            |     \
            |        \
        Even Parity     \                     Receiver
        Generator    [1][1100001] ---------------->
            |       /  Data Transmitted       11100001
            |    /
  VRC     [ 1 ]
  ```

- Performance of VRC
  - It can detect single bit error.
  - It can detect burst error only if the number of errors is odd.
  - Example:
    - Sender (11100001) --> Transmission Error (1 ${\color{lightblue}0}$ 100001) --> Receiver rejects this data
    - Sender (11100001) --> Transmission Error (1 ${\color{lightblue}0}$ 100 ${\color{lightblue}1}$ 01) --> Receiver accepts this data

### Longitudinal Redundancy Check (LRC)

- In LRC, a block of bit is organized in rows and columns.
- a.k.a Two Dimensional parity
- The parity bit is calculated for each column and sent along with the data.
- The block of parity acts as the redundant bits.
- Example

  ```[]
  Data -> 11100111 11011101 00111001 10101001
      1 1 1 0 0 1 1 1
      1 1 0 1 1 1 0 1
      0 0 1 1 1 0 0 1
      1 0 1 0 1 0 0 1
      ---------------
      1 0 1 0 1 0 1 0 <-- LRC
  ```

- Performance of LRC
  - LRC increases the likelihood of detecting burst errors.
  - If two bits in one data units are damaged and two bits in exactly the same positions in another data unit are also damaged, the LRC checker will not detect an error.

### Checksum

- Check = Check + sum
- Sender side - Checksum Creation, Receiver side - Checksum validation
- Checksum - Operation at sender side
  - Break the original message into 'k' number of blocks with 'n' bits in each block.
  - Sum all the 'k' data blocks.
  - Add the carry to the sum, if any
  - Do's 1's complement to the sum = Checksum.
- Example
  - Sender

  ```[]
    Data -> 10011001111000100010010010000100
                1 0 0 1 1 0 0 1
                1 1 1 0 0 0 1 0
                0 0 1 0 0 1 0 0
                1 0 0 0 0 1 0 0
                ---------------
    Carry (1 0) 0 0 1 0 0 0 1 1
                            1 0
                ---------------
                0 0 1 0 0 1 0 1
      1's       ---------------
    complement  1 1 0 1 1 0 1 0 <- Checksum
    Data sent -> 10011001111000100010010010000100 11011010
  ```

  - Receiver
    - Collect all the data blocks including the checksum.
    - Sum all the data blocks and checksum
    - If the result is all 1's ACCEPT else REJECT.

  ```[]
    Data received -> 10011001111000100010010010000100 11011010
                1 0 0 1 1 0 0 1
                1 1 1 0 0 0 1 0
                0 0 1 0 0 1 0 0
                1 0 0 0 0 1 0 0
                1 1 0 1 1 0 1 0
                ---------------
    Carry (1 0) 1 1 1 1 1 1 0 1
                            1 0
                ---------------
    Result      1 1 1 1 1 1 1 1
  ```

- Performance of Checksum
  - The checksum detects all errors involving an odd number of bits.
  - It detects most errors involving an even number of bits.
  - if one or more bits of a segment are damaged and the corresponding bit or bits of opposite value in a second segment are also damaged, the sums of these columns will not change and the receiver will not detect the error(s).

### Cyclic Redundancy Check (CRC)

- CRC Generation at sender side
  - Find the length of the divisor 'L'.
  - Append 'L-1' bits to the original message.
  - Perform binary division operation.
  - Remainder of the division = CRC.
  - CRC must be of L-1 bits.
- Example
  - Sender

  ```[]
    divisor ______data___________
    1 1 0 1 | 1 0 0 1 0 0:0 0 0 | 1 1 1 1 0 1
              1 1 0 1
              ---------
                1 0 0 0
                1 1 0 1
                ---------
                  1 0 1 0
                  1 1 0 1
                  ---------
                    1 1 1 0
                    1 1 0 1
                    ---------
                        1 1 0
                        0 0 0
                        -------
                        1 1 0 0
                        1 1 0 1
                        ---------
                          0 0 1 <-- CRC code
    Data sent -> 1 0 0 1 0 0 (0 0 1)
  ```

  - Receiver

  ```[]
  Data received -> 1 0 0 1 0 0 0 0 1

    divisor ______data___________
    1 1 0 1 | 1 0 0 1 0 0 0 0 1 | 1 1 1 0 1
              1 1 0 1
              ---------
                1 0 0 0
                1 1 0 1
                ---------
                  1 0 1 0
                  1 1 0 1
                  ----------
                    1 1 1 0
                    1 1 0 1
                    ---------
                        1 1 0 1
                        1 1 0 1
                        --------
                              0 <-- No errors found
  ```

### Network Performance

- Network performance is measure in following fundamental ways
  - Bandwidth
  - Throughput
  - Latency (Delay)

- Bandwidth
  - Informal: Maximum amount of data that can be transmitted per second.
  - Formal : The bandwidth of a network is given by the number of bits that can be transmitted over the network in a certain period of time.
  - Bandwidth in bps (wired medium)
    - Bandwidth = Capability
    - Example: Gigabit Ethernet can provide a bandwidth of 1 Gbps.
  - Bandwidth in hertz
    - A range of frequencies used to transmit signals which is measured in hertz.

- Throughout
  - Informal: Actual amount of data that passes through the medium.
  - Formal: The throughput is measure of how fast we can actually send data through a network.

- Although bandwidth in bits per second and throughput seem the same, they are different.
- A link may have a bandwidth of **'B'** bps, but we can only send **'T'** bps through this link with T < B always.

- Latency (Delay)
  - The latency or delay defines how long it takes for an entire message to completely arrive at the destination from the time the first bit is sent out from the source.
  - Latency is made of four components:
    - Transmission delay
    - Propagation delay
    - Queueing delay
    - Processing delay
  - Latency = Transmission delay + Propagation delay + Queueing delay + Processing delay

### Latency (Delay)

- Transmission Delay
  - Time it takes to place the complete data packet on the transmission medium.
  - Transmission time = Message size / Bandwidth

- Propagation Delay
  - Time it takes for a bit to go from device A to device B.
  - Propagation time = Distance / Propagation speed.

- Queuing Delay
  - Time needed for each intermediate or end device to hold the message before it can be processed.
  - The queuing time is not a fixed factor, it changes with the load imposed on the network.
  - When there is heavy traffic on the network, the queuing time increases.

- Processing Delay
  - Time a node takes to process the message.

### Bandwidth-delay Product

- The Bandwidth-delay product defines the number of bits that can fill the link.
- It is the capacity of the link.
- Volume in bits = Bandwidth in bps * Delay in s

### Round Trip Time ($R_{TT}$)

- a.k.a Round Trip Delay Time (RTD).
- It is the length of the time it takes for a signal to be sent plus the length of time it takes for an acknowledgement of that signal to be received.
- This time therefore consists of the propagation times between the two point of signal.
- If $T_{p}$ is the propagation time, then
   $R_{TT}$ = $2*T_{p}$

### Flow Control

- Speed matching mechanism.
- Flow control coordinates the amount of data that can be sent before receiving an acknowledgement.
- Flow control is a set of procedure that tells the sender how much data it can transmit before it must wait for an acknowledgement from the receiver.
- Receiver has a limited speed at which it can process incoming data and a limited amount of memory in which to store incoming data.
- Receiver must inform the sender before the limits are reached and request that the transmitter to send fewer frames or stop temporarily.
- Flow control protocol
  - Noiseless Channels
    - Simplest
    - Stop-and-wait
  - Noisy Channels
    - Stop-and-wait Automatic repeat request (ARQ)
    - Sliding window Protocol
      - Go-Back-N Automatic repeat request (ARQ)
      - Selective Repeat Automatic repeat request (ARQ)

### Stop-and-Wait Protocol

- Stop-and-Wait protocol is data link layer protocol for transmission of frames over noiseless channels.
- It provides unidirectional data transmission with flow control facilities but without error control facilities.
- After transmitting one frame, the sender waits for an acknowledgement before transmitting the next frame.
- Primitives of Stop-and-wait Protocol
  - Sender side
    - Rule 1: Send one data packet at a time
    - Rule 2: Send the next packet only after receiving ACK for the previous
  - Receiver side
    - Rule 1: Receive and consume data packet.
    - Rule 2: After consuming packet, ACK need to be sent (Flow Control)
- Problems of Stop-and-wait protocol
  - Problem due to lost data
    - Sender waits for ack for an infinite amount of time.
    - Receiver waits for data an infinite amount of time.
  - Problems due to lost ACK.
    - Sender waits for an infinite amount of time for ACK.
  - Problem due to delayed ACK/data.
    - After timeout on sender side, a delayed ACK might be wrongly considered as ACK of some other data packet.

### Stop-and-Wait Automatic repeat request Protocol

- After transmitting one frame, the sender waits for an acknowledgement before transmitting the next frame
- If the ACK does not arrive after a certain period of time, the sender times out and retransmits the original frame.
- Stop-and-wait ARQ = Stop-and-Wait + Timeout Timer + Sequence number
- Scenarios
  - The ACK is received before the timer expires
  - The original frame is lost
  - The ACK is lost
  - The timeout fires too soon
- Drawbacks
  - One frame at a time.
  - Poor utilization of bandwidth
  - Poor Performance

### Sliding Window Protocol

- Send multiple frames at a time.
- Number of frames to be sent is based on *Window size*.
- Each frame is numbered -> Sequence Number.

### Go-Back-N ARQ

- 'N' is the sender window size
- Go-Back-N ARQ uses the concept of protocol pipeline i.e. the sender can send multiple frame before receiving the acknowledgement for the first frame.
- There are finite number of frames and the frames are numbered in a sequential manner.
- The number of frames that can be sent depends on the window size of the sender.
- If the ACK of a frame is not received within an agreed upon time period, *all frames in the current window are transmitted*.
- The size of the sending windows determines the sequence number of the outbound frames.
- Example : if the sending windows size is 4 (${2^{2}}$), then the sequence numbers will be 0,1,2,3,0,1,2,3,0,1 and so on.
- The number of bits in the sequence number is 2 to generate the binary sequence 00, 01, 10, 11.

### Selective Repeat ARQ

- In Selective Repeat ARQ, only the erroneous or lost frames are retransmitted, while correct frames are received and buffered.
- The receiver while keeping track of sequence number, buffers the frames in memory and sends NACK for only frame which is missing or damaged.
- The sender will send/retransmit packet for which NARC is received.

### Multiple Access Protocols

- If there is a dedicated link between the sender and the receiver then data link control layer is sufficient, however if there is no dedicated link present then multiple stations access the channel simultaneously.
- Hence multiple access protocols are required to decrease collision and avoid crosstalk.
- Multiple-access protocols
  - Random access protocols
    - ALOHA
    - CSMA
    - CSMA/CD
    - CSMA/CA
  - Controlled-access protocols
    - Reservation
    - Polling
    - Token passing
  - Channelization protocols
    - FDMA
    - TDMA
    - CDMA

- To avoid access conflict, each station follows a protocol (procedure).
  - When can the station access the medium ?
  - What can the station do if the medium is busy ?
  - How can the station determine the success or failure of the transmission ?
  - What can the station do if there is an access conflict ?

- Random Access Protocols
  - In this, all stations have superiority that is no station has more priority than another station. Any station can send data depending on medium's state (idle or busy).
  - In a Random access method, each station has the right to the medium without being controlled by any other station.
  - If more than one station tries to send, there is an access conflict (COLLISION) and frames will be either destroyed or modified.

- Controlled Access Protocols
  - In controlled access, the stations consult one another to find which station has the right to send.
  - A station cannot send unless it has been authorized by other stations.

- Channelization Protocols
  - Channelization is a multiple-access method in which the available bandwidth of a link is shared in time, frequency, or through code, between different stations.

### Aloha

- Aloha is a random access protocol.
- It was actually designed for WLAN but it's also applicable for shared medium..
- In this, multiple stations can transmit data at the same time and can hence lead to collision and data being garbled.
- Types
  - Pure Aloha
  - Slotted Aloha

- Pure Aloha
  - Pure ALOHA allows stations to transmit whenever they have data to be sent.
  - When a station sends data it waits for an ACK.
  - If the ACK doesn't come within the allotted time then the station waits for a random amount of time called *back-off time (Tb)* and re-sends the data.
  - Since different stations wait for different amount of time, the probability of further collision decreases.
  - The throughput of pure aloha is maximized when frames are of uniform length.
  - Whenever two frames try to occupy the channel at the same time, there will be a collision and both will be garbled.
  - If the first bit of a new frame overlaps with just the last bit of a frame almost finished, both frames will be totally destroyed and both will have to be retransmitted later.
  - Vulnerable Time = ${2*T_{fr}}$ , where (${T_{fr}}$) is the frame transmission time.
  - Throughput = ${G*e^{-2G}}$, where G is the number of stations wish to transmit in the same time.
  - Maximum throughput = 0.184 for G = 0.5 i.e. (1/2).

- Slotted Aloha
  - It was developed just to improve the efficiency of pure aloha as the chances for collision in pure aloha are high.
  - The time of the shared channel is divided into discrete time intervals called slots.
  - Sending od data is allowed *only at the beginning* of these slots.
  - If a station misses out the allowed time, it must wait for the next slot. This reduces the probability of collision.
  - Vulnerable Time = ${T_{fr}}$ , where (${T_{fr}}$) is the frame transmission time.
  - Throughput = ${G*e^{-G}}$, where G is the number of stations wish to transmit in the same time.
  - Maximum throughput = 0.368 for G = 1

 Pure Aloha  | Slotted Aloha
-------------|----------------
 Any station can transmit the data at any time. | Any station can transfer the data at the beginning of any time slot.
 The time is continuous and not globally synchronized. | The time is discreet and globally synchronized.
 Vulnerable time in which collision may occur = ${2*T_{fr}}$. | Vulnerable time in which collision may occur = ${T_{fr}}$.
 Probability of successful transmission of data packet = ${G*e^{-2G}}$. | Probability of successful transmission of data packet = ${G*e^{-G}}$.
 Maximum efficiency = 18.4% (Occurs at G = 1/2). | Maximum efficiency = 36.8% (Occurs at G = 1).
 Main advantage: Simplicity in implementation. | Main advantage: It reduces the number of collision to half and double the deficiency of pure aloha.

### Carrier Sense Multiple Access (CSMA)

- CSMA Protocol
  - Carrier Sense Protocol
  - To minimize the chance of collision and therefore, increase the performance, the CSMA method was developed.
  - Principle of CSMA: "sense before transmit" or "listen before talk"
  - Carrier busy = Transmission is taking place.
  - Carrier idle = No transmission currently taking place.
  - The probability of collision still exists because of propagation delay, a station may sense the medium and find it idle, only because the first bit sent by another station has not yet been received.
  - Types of CSMA
    - 1-Persistent CSMA
    - P-Persistent CSMA
    - Non-Persistent CSMA
    - O-Persistent CSMA
  - Modified
    - CSMA/CD (CSMA with Collision Detection)
    - CSMA/CA (CSMA with Collision Avoidance)

- 1-persistent CSMA
  - Before sending the data, the station first listens to the channel to see if anyone else is transmitting the data at that moment.
  - If the channel is idle, the station transmits a frame.
  - If busy, then it senses the transmission medium continuously until it becomes idle.
  - Since the station transmit the frame with the probability of 1 when the carrier or channel is idle, this scheme of CSMA is called as 1-Persistent CSMA.
  - The propagation delay has an important effect on the performance of the protocol.
  - The longer the propagation delay, the more important this effect becomes, and the worse the performance of the protocol.

- Non-Persistent CSMA
  - Before sending, a station senses the channel. If no one else is sending the station begins doing so itself.
  - However, if the channel is already in use, the station does not continually sense it for the purpose of seizing it immediately upon detecting the end of the previous transmission.
  - Instead, it wait a random period of time and then repeats the algorithm. Consequently, the algorithm leads to better channel utilization but longer than 1-persistent CSMA.

- P-persistent CSMA
  - It applies to slotted channels.
  - When a station becomes ready to send, it senses the channel.
  - If it is idle, it transmits with a probability P.
  - With a probability Q=1-P, it defers until the next slot.
  - If that slot is also idle, it either transmits or defers again, with probabilities P and Q.
  - This process is repeated until either the frame has been transmitted or another station has begun transmitting.
  - In the latter case, the unlucky station acts as if there had been a collision (i.e, it waits a random time and starts again).
  - If the station initially senses the channel busy, it waits until the next slot and applies the above algorithm.

- O-persistent CSMA
  - Each node is assigned a transmission order by a supervisory node.

- CSMA/CD (CSMA with Collision Detection)
  - If two stations sense the channel to be idle and begin transmitting simultaneously, they will both detect the collision almost immediately.
  - Rather than finish transmitting their frames, which are irretrievably garbled anyway, they should abruptly stop transmitting as soon as the collision is detected.
  - Quickly terminating damaged frames saves time and bandwidth.
  - This protocol, known as CSMA/CD is widely used on LANs in the MAC sublayer.
  - Access method used by Ethernet: CSMA/CD.
  - Let's have point ${t_{0}}$, a station has finished transmitting its frame.
  - Any other station having a frame to send may now attempt to do so. If two or more station decide to transmit simultaneously, there will be a collision.
  - Collisions can be detected by looking at the power or pulse width of the received signal and comparing it to the transmitted signal.
  - After a station detects a collision, it aborts its transmission, waits a random period of time, and then tries again, assuming that no other station has started transmitting in the meantime.
  - Therefore, model for CSMA/CD will consist of alternating contention and transmission periods, with idle periods occurring when all stations are quiet
  - For gate
    - Efficiency = ${\frac{1}{1+ 6.44a}}$
    - a = ${\frac{T_{p}}{T_{t}}}$
    - If distance increases, efficiency of CSMA decreases.
    - CSMA is not suitable for long distance networks like WAN; but works optimally for LAN.
    - If length of packet is bigger, the efficiency of CSMA also increases, but maximum limit for length is 1500 Bytes.
    - Transmission Time >= Round Trip Time of 1 bit
    - Transmission Time >= 2*Propagation Time

- CSMA/CA (CSMA with Collision Avoidance)
  - Carrier-sense multiple access with collision avoidance (CSMA/CA) is a network multiple access method in which carrier sensing is used, but nodes attempt to avoid collisions by beginning transmission only after the channel is sensed to be "idle".
  - It is particularly important for wireless networks, where the collision detection of the alternative CSMA/CD is not possible due to wireless transmitters desensing their receivers during packet transmission
  - CSMA/CA is unreliable due to the hidden node (terminal) and exposed node (terminal) problem.
  - Solutions are RTS/CTS exchange.
  - CSMA/CA is a protocol that operates in the Data Link Layer (Layer 2) of the OSI model.
  - The access method used by IEEE 802.11 Wi-Fi is CSMA/CA.

### Reservation

- A station need to make a reservation before sending data.
- In each interval, a reservation frame precedes the data frames in that interval.
- If there are N stations in the system, there are exactly N reservation ministate in the reservation frame.
- Each mini-slot belongs to a station.
- When a station needs to send a data frame, it makes a reservation in its own mini-slot.
- The stations that have made reservations can send their data frames after the reservation frame.

### Polling

- The polling protocol requires one of the nodes to be designated as a Master node (Primary station).
- The master node polls each of the nodes in a round-robin fashion.
- In particular, the master node first sends a message to node 1, saying that (node 1) it can transmit up to some maximum number of frames.
- After node 1 transmit some frames, the master node tells node 2 (node 2) it can transmit up to the maximum number of frames.
- The master node can determine when a node has finished sending its frames by observing the lack of a signal on the channel.
- The procedure continues in this manner, with the master node polling each of the nodes in a cyclic manner.
- Advantages
  - The polling protocol eliminates the collision.
  - This allows polling to achieve a much higher efficiency.
- Disadvantages
  - The first drawback is that the protocol introduces a polling delay the amount of time required to notify a node that it can transmit.
  - The second drawback, which is potentially more serious, is that if the master node fails, the entire channel becomes inoperative.
- Polling - Function
  - Poll function : If the primary wants to receive data, it asks the secondaries if they have anything to send.
  - Select function : If the primary wants to send data, it tells the secondary to get ready to receive.
- Efficiency of Polling
  - Let ${T_{poll}}$ be the time for polling and ${T_{t}}$ be the time required for transmission of data. Then, Efficiency = ${\frac{T_{t}}{T_{t} + T_{poll}}}$

### Token Passing

- A station is authorized to send data when it receives a special frame called a token.
- Here there is no master node.
- A small, special-purpose frame known as a token is exchanged among the nodes in some fixed order.
- When a node receives a token, it holds onto the token only if it has some frames to transmit; otherwise, it immediately forwards the token to the next node.
- If a node does have frames to transmit when it receives the token, it sends up to a maximum number of frame and then forwards the token to the next node.
- Token passing is decentralized and highly efficient, but it has problems as well.
- Example
  - The failure of one node can crash the entire channel.
  - If a node accidentally neglects to release the token, then some recovery procedure must be invoked to get the token back in circulation.
- Types of networks
  - Physical ring
  - Dual ring
  - Bus ring
  - Star ring
- Performance of token passing
  - ${S = \frac{1}{1 + a/N}    : for a<1}$
  - ${S = \frac{1}{a(1 + 1/N)} : for a>1}$
  - ${a = \frac{T_{p}}{T_{t}}}$
  </br>where
    - S = Throughput
    - N = number of stations
    - ${T_{p}}$ = Propagation  delay
    - ${T_{t}}$ = Transmission  delay

#### Multiplexing

- Multiplexing in computer networking means multiple signals are combined together thus travel simultaneously in a shared medium.
- Multiplexing = Sharing the bandwidth.

### Frequency Division Multiple Access (FDMA)

- In FDMA, the available bandwidth of the common channel is divided into bands that are separated by guard bands.
- The available bandwidth is shared by all stations.
- The FDMA is a data link layer protocol that uses FDM at the physical layer.

### Time Division Multiple Access (TDMA)

- In TDMA, the bandwidth is just one channel that is time shared between different stations.
- The entire bandwidth is just one channel
- Stations share the capacity of the channel in time.

### Code Division Multiple Access (CDMA)

- In CDMA, one channel carries all transmissions simultaneously.
- CDMA differs from FDMA because only one channels occupies the entire bandwidth of the link.
- It differ from TDMA because all station can send data simultaneously, there is no time sharing.
- The assigned codes have two properties:
  - If we multiply each code by another, we get 0.
  - If we multiply each code by itself, we get the number of stations (4).
  - Example:
    - Data = (${d_{1}c_{1}}$ + ${d_{2}c_{2}}$ + ${d_{3}c_{3}}$ + ${d_{4}c_{4}}$)*${c_{1}}$ = 4 ${d_{1}}$

### Ethernet

- One of the most widely used Wired LAN technologies.
- Operates in the data link layer and the physical layer.
- Family of networking technologies that are defined in the IEEE 802.2 and 802.3 standards.
- Support data bandwidth of 10, 100, 1000, 10000, 40000 and 100000Mbps (100Gbps).
- Ethernet Standards
  - Define Layer 2 protocols and Layer 1 technologies.
  - Two separate sublayers of the data link layer to operate - Logical Link control (LLC) and the MAC sublayers.
- Ethernet evolution
  - Standard Ethernet 10 Mbps
  - Fast Ethernet 100 Mbps
  - Gigabit Ethernet 1 Gbps
  - Ten-Gigabit Ethernet 10 Gbps
- Ethernet Frame Format
  - Preamble: 56 bits of alternating 1s and 0s.
  - SFD: Start frame delimiter, flag (10101011)
  - Physical layer header : first 8 bytes

   Preamble | SFD    | Destination address | Source address | Length or type | Data & padding | CRC
  ----------|--------|---------------------|----------------|----------------|----------------|---------
   7 bytes  | 1 byte | 6 bytes             | 6 bytes        | 2 bytes        |                | 4 bytes

- Ethernet Frame - Min and Max Length
  - Minimum payload length : 46 bytes
  - Maximum payload length : 1500 bytes

   Destination address | Source address | Length PDU     | Data & padding | CRC
  ---------------------|----------------|----------------|----------------|---------
   6 bytes             | 6 bytes        | 2 bytes        |                | 4 bytes
  
  - Minimum frame length: 512 bits or 64 bytes
  - Maximum frame length: 12144 bits or 1518 bytes

- Ethernet Address
  - Example - 06:01:02:03:2C:4B <=> 6 bytes <=> 12 hex digits <=> 48 bits
  - The least significant bit of the first bytes defines the type of address.
  - If the bit is 0, the address is unicast, otherwise, it's multicast.
    - Example:  10101010 <- unicast, 10101011 <- multicast address.
  - If all bits are 1, then it is broadcast address.

- Access Protocol For Ethernet
  - The algorithm is commonly called Ethernet's Media Access Control (MAC) which is implemented in Hardware on the network adaptor.
  - Access Method of Ethernet: CSMA/CD
  - Encoding method: Manchester Encoding Technique for converting data bit into signals.

- Ethernet Transmitter Algorithm
  - When the adaptor has a frame to send and the line is idle, it transmits the frame immediately.
  - The upper bound of 1500 bytes in the message means that the adaptor can occupy the line for a fixed length of time.
  - When the adaptor has a frame to send and the line is busy, it wait for the line to go and then transmits immediately.
  - The ethernet is said to be CSMA 1-persistent protocol because an adaptor with a frame to send transmits with probability 1 whenever a line goes idle.
  - Since there is no centralized control it is possible for two (or more) adaptors to begin transmitting at the same time, either because both found the line to be idle or both had been waiting for a busy line to become idle.
  - When this happen, the two (or more) frames are said to be collide on the network.
  - Since ethernet support collision detection, each sender is able to determine that a collision is in progress.
  - At the moment an adaptor detects that its frame is colliding with another, it first makes sure to transmit a 32-bit jamming sequence and then stops transmission.
  - Thus, a transmitter will minimally send 96 bits in the case of collision 64-bit preamble + 32-bit jamming sequence.
  
- Runt Frames
  - Runt Frames is an Ethernet frame that is less than the IEEE 803.3's minimum length of 64 bytes.
  - Runt frames are most commonly caused by collisions.
  - Other possible causes are a malfunctioning network card, buffer underrun, duplex mismatch or software issues.

- Exponential Back off
  - Once an adapter has detected a collision and stopped its transmission, it waits a certain amount of time and tries again.
  - Each time the adaptor tries to transmit but fails, it doubles the amount of time it wait before trying again.
  - This strategy of doubling the delay interval between each retransmission attempt is known as Exponential Back off.

- Ethernet - Pros
  - Ethernet is the most widely used wired LAN technology.
  - Ethernet is relatively inexpensive.
  - In ethernet, all the node have the same privileges. It does not follow client-server architecture.
  - Maintenance and administration are simple.
  - The cable used to connect systems in ethernet is robust to noise.
  - As it is robust to the noise, the quality of the data transfer does not degrade. The data transfer quality is good.
  - With latest versions such as gigabit ethernet, the transfer speeds in Gbps have become possible.

- Ethernet - Cons
  - Under heavy loads, too much of the network's capacity is wasted by collisions.
  - It does not hold good for real-time application and interactive applications.
  - As the network cannot set priority for the packets, it is not suitable for a client-server architecture.
  - For interactive application, dummy data have to be fed to make the frame size 46B which in mandatory.
  - After receiving a packet, the receiver doesn't send any acknowledgement.

- Ethernet CATS
   Category | Shielding              | Max transmission speed (at 100 meters)
  ----------|------------------------|----------------------------------------
   CAT 3    | Unshielded             | 10 Mbps
   CAT 5    | Unshielded             | 10/100 Mbps
   CAT 5e   | Unshielded             | 1000 Mbps / 1 Gbps
   CAT 6    | Shielded or Unshielded | 1000 Mbps / 1 Gbps
   CAT 6a   | Shielded               | 1000 Mbps / 10 Gbps
   CAT 7    | Shielded               | 1000 Mbps / 10 Gbps
   CAT 8    | Shielded               | up to 40 Gbps

### IEEE 802.11 Wi-Fi

- Wireless Fidelity (Wi-Fi)
  - Like its Ethernet and token ring siblings, 802.11 is designed for use in a limited geographical area (homes, office buildings, campuses).
  - Primary challenge is to mediate access to a shared communication medium - in this case, signals propagating through space.
  - 802.11 supports additional features
    - power management and
    - security mechanisms
  - 802.11 uses 5 GHz Radio Band (High frequency) which has 23 non-overlapping channels rather than the 2.4 GHz frequency band which has only three non-overlapping channels.
  - Access Methods of IEEE 802.11 Wi-Fi: CSMA/CA
  - Modes of Wi-Fi
    - Infrastructure mode
    - Ad hoc and Wi-Fi Direct
  - Different Wi-Fi protocols
    Protocol       | Frequency       | Channel Width      | Maximum data rate </br>(theoretical)
    ---------------|-----------------|--------------------|--------------------
    802.11ax       | 2.4GHz or 5GHz  | 20,40,80,160 MHz   | 2.4 Gbps
    802.11ac wave2 | 5GHz            | 20,40,80,160 MHz   | 1.73 Gbps
    802.11ac wave1 | 5GHz            | 20,40,80 MHz       | 866.7 Mbps
    802.11n        | 2.4GHz or 5GHz  | 20,40 MHz          | 450 Mbps
    802.11g        | 2.4GHz          | 20 MHz             | 54 Mbps
    802.11a        | 5GHz            | 20 MHz             | 54 Mbps
    802.11b        | 2.4GHz          | 20 MHz             | 11 Mbps
    Legacy 802.11  | 2.4GHz          | 20 MHz             | 2 Mbps

- Distribution System
  - 802.11 is suitable for an ad-hoc configuration of nodes that may or may not be able to communicate with all other nodes.
  - Nodes are free to move around
  - The set of directly reachable nodes may change over time.
  - To deal with this mobility and partial connectivity,
    - 802.11 defines additional structure on a set of nodes.
    - Instead of all nodes being created equal,
      - some nodes are allowed to roam and some are connected to a wired network infrastructure, they are called Access Points (AP) and they are connected to each other by a so-called *distribution system*.
  - Access points connected to a distributed network.

    ```[]
       +------------------------+
       | Distribution system    |
       +------------------------+
       | AP-1 / \  AP-2 | AP-3  |
       | A   | B |   H  | G   F |
       |   C  \ /  D   / \  E   |
       +-------+------+   +-----+
    ```

    - Assume a distribution system that connects three access points, each of which services the nodes in the same region.
    - Each of these regions is analogous to a cell in a cellular phone system with the APIs playing the same role as a base station.
    - Although two nodes can communicate directly with each other if they are within reach of each other, the idea behind this configuration is
      - Each nodes associates itself with one access point.
      - For node A to communicate with node E, A first sends a frame to its AP-1 which forwards the frame across the distribution system to AP-3, which finally transmits the frame to E.
    - How does the nodes select their AP ?
      - The technique for selecting an AP is called *scanning*.
        - The node sends a Probe frame.
        - All APs within reach reply with a Probe Response frame.
        - The node selects one of the one of the access points and sends that AP an Association Request frame.
        - The AP replies with an Association Response frame.
      - A node engages this protocol whenever it joins the network as well as
      - When it becomes unhappy with its Access Point (AP)?
        - This might happen, for example, because the signal from its current AP has weakened due to the node moving away from it.
        - Whenever a node acquires a new AP, the new AP notifies the old AP of the change via the distribution system.
    - Consider the situation when node C moves from the cell serviced by AP-1 to the cell serviced by AP-2.
      - As it moves, it sends Probe frames, which eventually result in Probe Responses from AP-2.
      - At some point, C prefers AP-2 over AP-1, and so it associates itself with that access point. This is called *active scanning* since the node is actively searching for an access point.
      - APs also periodically sends a Beacon frame that advertises the capabilities of the access point, these include the transmission rate supported by the AP. This is called *passive scanning*.
      - A node can change to this AP based on the Beacon frame simply by sending it an Association Request frame back to the access point.

- Wifi Frame Format
   2  bytes  | 2 bytes | 6 bytes | 6 bytes | 6 bytes | 2 bytes | 6 bytes | 0-23122 bytes | 4 bytes
  -------------------|----------|----------|----------|----------|-----|--------|--------|---------
   Frame</br>control | Duration | Address 1| Address 2| Address 3| Seq.| Address 4| Data | Checksum

  - Frame control
    - It is a 2bytes starting field composed of 11 subfields. It contains control information of the frame.
    - It has 11 subfields.
  
    2 bits  | 2 bits | 4 bits | 1 bit  | 1 bit  | 1 bit  | 1 bit  | 1 bit  | 1 bit  | 1 bit  | 1 bit
    --------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------
    Version | Type  | Subtype | To DS | From DS | MF     | Retry  | Pwd    | More   | W      | 0
  
    - Protocol Version : The first sub-field is a two-bit field set to 00. It has been included to allow future versions of IEEE 802.11 to operate simultaneously.
    - Type : It is a two-bit subfield that specifies whether the frame is a data frame, control frame or management frame.
    - Subtype : It is a four-bit subfield states whether the field is a Request to Send (RTS) or a Clear to Send (CTS) control frame. For a regular data frame, the value is set to 0000.
    - To DS : A single bit subfield indicating whether the frame is going to the access point (AC), which coordinates the communications in centralized wireless systems.
    - From DS : A single bit subfield indicating whether the frame is coming from the Access point.
    - More Fragments : A single bit subfield which when set to 1 indicates that more fragments would follow.
    - Retry : A single bit subfield which when set to 1 specifies a retransmission of a previous frame.
    - Power Management : A single bit subfield indicating that the sender is adopting power-save mode.
    - More Data: A single bit subfield showing that sender has further data frames for the receiver.
    - WEP : A single bit subfield indicating that this is an encrypted frame.
    - Order : The last subfield of one-bit, informs the receiver that to the higher layers the frames should be in an ordered sequence.
  - Duration :
    - It is a 2-byte field that specifies the time period for which the frame and its ACK occupy the channel.

  </br>

  To</br>DS | From</br>DS | Address</br>1 | Address</br>2 | Address</br>3 | Address</br>4
  ----------|-------------|---------------|---------------|---------------|---------------
   0        | 0           | Destination   | Source        | BSS ID        | N/A
   0        | 1           | Destination   | SendingAP     | Source        | N/A
   1        | 0           | ReceivingAP   | Source        | Destination   | N/A
   1        | 1           | ReceivingAP   | SendingAP     | Destination   | Source

  - Sequence : It is 2 bytes field that stores the frame numbers. It detects duplicate frames and determines the order of frames for higher layers. Among the 16 bits, the first 4 bits provides identification to the fragment and the rest 12 bits contain the sequence number that increments with each transmission.
  - Data : This is a variable sized field that carries the payload from the upper layers. The maximum size of data field is 2312 bytes.
  - Checksum: It's a 4-byte field for error detection purpose.

### Terminal Problem

- Hidden Terminal Problem

  ```[]
          .   .     .   .
      .          .         .
    .          .   .         .
   .      [A] .  B  .  [C]    .
    ,          ,   ,         ,
      .          .         .
        '  . . '   ' . . '
  ```

  - Suppose both A and C want to communicate with B and so they each send it a frame.
    - A and C are unaware of each other since their signals do not carry that far.
    - These two frames collide with each other at B (but unlike an ethernet, neither A nor C is aware of this collision).
    - A and C are said to hidden nodes with respect to each other.
  - Solution to hidden terminal problem.
    - Multiple Access Collision Avoidance (MACA) Algorithm - RTS and CTS frames

- Exposed Terminal Problem

  ```[]
          .  .   .   .
      .      . " .      .
    .      .       .      .
   .   A   .[B]  [C].  D   .
    ,       ,      ,      ,
      .       .  .       .
        '  . . '' . . '
  ```

  - Suppose B is sending to A. Node C is aware of this communication because it hears B's transmission.
    - It would be a mistake for C to conclude that it cannot transmit to anyone just because it can hear B's transmission.
    - Suppose C want to transmit to node D.
    - This is not a problem since C's transmission to D will not interfere with A's ability to receive from B.
  - Solution to exposed terminal problem.
    - Multiple Access Collision Avoidance (MACA) Algorithm - RTS and CTS frames

- Multiple Access with Collision Avoidance (MACA)
  - 802.11 addresses these two problems with an algorithm called Multiple Access with Collision Avoidance (MACA).
  - Key idea : Sender and receiver exchange control frames with each other before the sender actually transmit any data.
  - This exchange informs all nearby nodes that a transmission is about to begin.
  - Sender transmit a *Request to Send (RTS)* frame to the receiver
    - The RTS frame includes a field that indicates how long the sender wants to hold the medium. Length of the data frame to be transmitted.
  - Receiver replies with a *Clear to Send (CTS)* frame
    - This frame echoes this length field back to the sender
  - Any node that sees the CTS frame knows that
    - it is close to the receiver, therefore
    - cannot transmit for the period of time it takes to send a frame of the specified length
  - Any node that sees the RTS frame but not the CTS frame
    - is not close enough to the receiver to interface with it, and
    - so is free to transmit

  - The idea of using ACK in MACA is Proposed in MACAW : MACA for wireless LANs.
  - Receiver sends an ACK to the sender after successfully receiving a frame.
  - All nodes must wait for this ACK before trying to transmit
  - If two or more nodes detect an idle link and try to transmit an RTS frame at the same time.
    - Their RTS frame will collide with each other.
  - *802.11 does not support collision detection*.
    - So the sender realize the collision has happened when they do not receive the CTS frame after a period of time.
    - The amount of time a given node delay is defined by the same *exponential back off algorithm* used on the Ethernet.

### IEEE 802.15.1 Bluetooth

- Bluetooth
  - Bluetooth is a wireless technology standard used for exchanging data between fixed and mobile devices over short distances using short-wavelength ultra high frequency (UHF) radio waves in the industrial scientific medical (ISM) radio bands from 2.400 to 2.485 GHz and building area networks (PANs).
  - It was originally conceived as a wireless alternative to RS-232 data cables.
  - Bluetooth is a wireless technology named after Harald Bluetooth based on an analogy that Bluetooth technology would unite devices the way Harald Bluetooth united the tribes of Denmark into a single kingdom.
  - Bluetooth is specified by an industry consortium called the Bluetooth Special Interest Group (SIG).
  - It specifies an entire suite of protocols, going beyond the link layer to define application protocols, which it calls profiles, for a range of applications.
    - There is a profile for synchronizing a personal digital assistance (PDA) with personal computer.
    - Another profile gives mobile computer access to a wired LAN.
  - The basic Bluetooth network configuration is called piconet.
    - Consists of a master device and up to seven slave devices.
    - Any communication is between the master and a slave.
    - The slaves do not communicate directly with each other.
    - A slave can be parked: set to an inactive, low-power state.
    - The complex configuration of the piconet results in scatternet.
  - Pros
    - Low cost
    - Easy to use
    - It can also penetrate through walls.
    - It creates an ad-hoc connection immediately without any wires.
    - It is used for voice and data transfer.
  - Cons
    - It can be hacked and hence, less secure.
    - It has slow data transfer rate.
    - It has small range : 10 meters.

- Bluesnarfing
  - Bluesnarfing is the unauthorized access of information from a wireless device through a Bluetooth connection, often between phones, desktops, laptops and PDAs.
  - This allows access to calendars, contact lists, email and text messages, and on some phones, users can copy pictures and private videos.
  - Bluesnarfing is the theft of information from the target device.

- Bluetooth Protocol Stack

  ```[]
    +------------------------------------------------------------+
    |                 Application/ Profiles                      | Application layer
    +-------+---------+--------+-----------+-----------+---------+
    |       |  Other  | RFcomm | Telephony | Service   |         | Middleware layer
    | Audio |  [LLC]  |        |           | discovery | Control |
    |       +---------+--------+-----------+-----------+         |
    |       | Logical link control adaptation protocol |         | Data link layer
    |       |          [ Link manager ]                |         |
    +-------+------------------------------------------+---------+
    |                  Baseband                                  | Physical layer
    +------------------------------------------------------------+
    |                  Physical radio                            |
    +------------------------------------------------------------+
  ```

  - Physical Radio (RF) layer : It performs modulation/demodulation of the data into RF signals. It defines the physical characteristics of bluetooth transceiver. It defines two types of physical link : connection-less and connection-oriented.
  - Baseband Link Layer : It performs the connection establishment within a piconet.
  - Link Manager protocol layer : It performs the management of the already established links. It also includes authentication and encryption processes.
  - Logical Link Control and Adaption protocol layer : It is also known as the heart of the bluetooth protocol stack. It allows the communication between upper and lower layer of the bluetooth protocol stack. It packages the data packets received from upper layers into the form expected by lower layers. It also performs the segmentation and multiplexing.
  - RF comm layer : It is short for Radio Frontend Component. It provides serial interface with wireless application protocol (WAP) and object exchange (OBEX).
  - TCS : It is short for Telephony Control Protocol. It provides telephony service.
  - SDP layer : It is short for Service Discovery Protocol. It allows to discover the services available on another bluetooth enables device.
  - Application layer : It enables the user to interact with the application.

### Virtual Local Area Network (VLAN)

- A VLAN is a logical partitioning of a layer 2 network.
- Multiple partitions can be created, allowing for multiple VLANs to co-exist.
- Each VLAN is a broadcast domain, usually with its own IP network.
- VLANs are mutually isolated and packets can only pass between then via a router.
- The partitioning of layer 2 network takes place inside a layer 2 device, usually via a switch.
- The hosts grouped with a VLAN are unaware of the VLAN's existence.
- Types of VLAN
  - Data VLAN
  - Default VLAN
  - Native VLAN
  - Management VLAN
  - Voice VLAN
- Pros
  - Security
  - Cost reduction
  - Better performance
  - Shrinks broadcast domains.
  - Improved IT staff efficiency.
  - Simpler project and application management.

- VLAN Frame Tagging

  ```[]
    Ethernet Frame
  +---------+--------+-------------+------+-----+
  | Dst MAC | SrcMAC | Type/Length | Data | FCS |
  +---------+--------+-------------+------+-----+

    IEEE 802.1Q Frame
  +---------+---------+-----+-------------+------+-----+
  | Dst MAC | Src MAC | Tag | Type/Length | Data | FCS |
  +---------+---------+-----+-------------+------+-----+
                   /           \
               /                   \
            /                          \
         /                                 \
      /                                        \
   /                                               \
  +---------------+----------+-----+-----------------+
  | Ethernet      | Priority |  C  | VLAN identifier |
  | Type (0x8100) |          |     |                 |
  +---------------+----------+-----+-----------------+
    2 bytes         3 bits    1bit     12 bits
  ```

  - Frame tagging is the process of adding a VLAN identification header to the frame
  - It is used to properly transmit multiple VLAN frames through a trunk link.
  - Switches tag frames to identify the VLAN to that they belong. Different tagging protocol exist; IEE802.1Q is very popular example.
  - The protocol defines the structure of the tagging header added to the frame.
  - Switches add VLAN tags to the frames before placing then into trunk links and remove the tag before forwarding frames through no-trunk ports.
  - When properly tagged, the frames can transverse any number of switches via trunk links and still be forwarded within the correct VLAN at the destination.

### IEEE 802.1D Spanning Tree Protocol (STP)

- Redundancy
  - Enables users to access network resources, despite path disruption.
    - improves reliability
    - improves availability
  - In technology, 2 is 1 and 1 is none, single connection mean single point of failure.
    - Creating redundant links is very simple and is advisable.

- Key Facts - STP
  - Original STP (802.1D) was created to prevent loops.
  - Switches send probes into the network to discover loops.
  - These probes are called as Bridge Protocol Data Unit (BPDU).
  - BPDU will have specific information about the switch.
  - Switch multicasts BPDU probes (every 2 second) and if it receives its own BPDU back, it means there is a loop in the network.
  - Also the BPDU probes helps to elect the root bridge.
  - All switches will find the best way to reach the root bridge and the redundant links will be blocked (Port cost).

    ```[]
      +---------------------------------------------+
      |            BPDU (Bridge ID)                 |
      +-----------------+---------------------------+
      | Bridge Priority | MAC address of the switch |
      +-----------------+---------------------------+
    ```

  - Root Bridge
    - The Root Bridge will have the lowest bridge id.
    - If Tie, the bridge with the lowest MAC address will be the Root bridge.
  - Port Roles
    - Root Port (Used to reach the root bridge)
    - Designated Port (Forwarding port: One per link)
    - Blocking/Non Designated Port (Loops)

- Spanning Tree Protocol
  - STP ensures that there is only one logical path between all destinations on the network by intentionally blocking redundant paths that could cause a loop.
  - A port is considered blocked when user data is prevented from entering or leaving that port. This does not include bridge protocol data unit (BPDU) frames that are used by STP to prevent loops.
  - The physical parts still exist to provide redundancy, but these paths are disabled to prevent the loop from occurring.
  - If the path is even needed to compensate for a network cable or switch failure, STP recalculate the paths and unblocks, the necessary ports to allow the redundant path to become active.

## Logical Addressing & Subnetting

### IPv4 Addresses

- An IPv4 address is a 32-bit address that uniquely and universally defines the connection of a device (for example, a computer or a router) to the Internet.
- An IPv4 address is 32 bits long.
- Two devices on the Internet can never have the same address at the same time.
- The address space of IPv4 is ${2^{32}}$ or 4,294,967,296 (more than 4 billion).
- Notation : binary notation = 01110101 10010101 00011101 00000010, decimal notation = 117.149.29.2

### Classful Addressing

- Classes of IPv4 address

  Address</br> Class | 1st Octet</br>range in</br>decimal | 1st Octet bits | Network(N) and</br>Host(H) Portion | Default mask </br>(Decimal) | Number of possible</br>network and host per</br>network
  ----|----------|--------------------------|--------------|-----------|-------------------------------------------------------
   A  | 0-127    | 00000000 -</br> 01111111 | N.H.H.H      | 255.0.0.0 | 128 Nets (${2^{7}}$) </br> 16,777,214 hosts (${2^{24}-2}$)
   B  | 128-191  | 10000000 -</br> 10111111 | N.N.H.H      | 255.255.0.0 | 16384 Nets (${2^{14}}$) </br> 65534 hosts (${2^{16}-2}$)
   C  | 192-223  | 11000000 -</br> 11011111 | N.N.N.H      | 255.255.255.0 | 209150 Nets (${2^{21}}$) </br> 254 hosts (${2^{8}-2}$)
   D  | 224-239  | 11100000 -</br> 11101111 | (Multicast)  | -         | -
   E  | 240-255  | 11110000 -</br> 11111111 |(Experimental)| -         | -

- Subnet mask

  Class | Subnet Mask</br>(in Decimal) | Subnet Mask (in Binary) | Slash Notation
  ------|-----------------|--------------------------------------|----------------
   A    | 255.0.0.0       | 11111111.00000000.00000000.00000000  | /8
   B    | 255.255.0.0     | 11111111.11111111.00000000.00000000  | /16
   C    | 255.255.255.0   | 11111111.11111111.11111111.00000000  | /24

  - To define the network and host portions of an address, devices use a separate 32-bit pattern called a subnet mask.
  - The subnet mask does not actually contain the network or host portion of an IPv4 address, it just says where to look for these portions in a given IPv4 address.

### IPv4 transmission

- In an IPv4 network, the hosts can communicate one of three different ways
  - Unicast
    - Unicast Transmission : The process of sending a packet from one host to an individual host.
  - Broadcast
    - Broad Transmission : The process of sending a packet from one host to all hosts in the network.
    - Limited Broadcast : Destination 255.255.255.255
      - Router do not forward a limited broadcast.
    - Directed broadcast : Destination 172.16.4.255
      - Host within the 172.16.4.0/24 network
  - Multicast
    - Multicast Transmission : The process of sending a packet from one host to a selected group of hosts, possibly in different networks.
      - Multicast transmission reduces traffic
      - The Multicast Address range : 224.0.0.0 to 239.255.255.255
      - Link local - 224.0.0.0 to 224.0.0.255 (Example : routing information exchanged by routing protocols)
      - Globally scoped addresses - 224.0.1.0 to 238.255.255.255 (Example 224.0.1.1 has been reserved for Network Time Protocol)

### Private and Public IP Addresses

- Private IP Addresses
  - Early network design, when global end-to-end connectivity was envisioned for communications with all Internet hosts, intended that IP addresses be globally unique. However, it was found that this was not always necessary as private networks developed and public address space needed to be conserved.
  - Computers not connected to the Internet, such as factory machines that communicate only with each other TCP/IP, need not have
  globally unique IP addresses. Today, such private networks are widely used and typically connect to the Internet with network address translation (NAT), when needed.
  - Hosts that do not require access to the Internet can use private addresses
    - 10.0.0.0 to 10.255.255.255 (10.0.0.0/8)
    - 172.16.0.0 to 173.31.255.255 (172.16.0.0/12)
    - 192.168.0.0 to 192.168.255.255 (192.168.0.0/16)
  - The aforementioned are the three non-overlapping ranges of IPv4 addresses for private networks are reserved.

- Special use IPv4 Addresses
  - Network and Broadcast addresses - within each network the first and last addresses cannot be assigned to hosts.
  - Loopback address - 127.0.0.1 a special address that hosts use to direct traffic to themselves (addresses 127.0.0.0 to 127.255.255.255 are reserved).
  - Link-Local address - 169.254.0.0 to 169.254.255.255 (169.254.0.0/16) addresses can be automatically assigned to the local host.
  - Test-net addresses - 192.0.2.0 to 192.0.2.255 (192.0.2.0/24) set aside for teaching and learning purposes, used in documentation and network examples.
  - Experimental addresses - 240.0.0.0 to 255.255.255.254 are listed as reserved.

- In a nutshell..
  - Private IP address is used to communicate within the same network.
  - Using private IP data or information can be sent or received within the same network.

  - Public Ip address is used to communicate outside the network. Public IP address is basically assigned by the Internet Service Provider(ISP).

### Classless Addressing

- Drawbacks of Classful Addressing
  - **Lack of Internal Address Flexibility** : Big organizations are assigned large "monolithic" blocks of addresses that don't match well the structure of their underlying internal networks.
  - **Inefficient use of Address Space** : The existence of only three block sizes (classes A,B and C) leads to waste of limited IP address space.
  - **Proliferation of Router Table Entries** : As the Internet grows, more and more entries are required for routers to handle the routing of IP datagrams, which causes performance problems for routers. Attempting to reduce inefficient address space allocation leads to even more router table entries.

- Formal name of Classless Addressing is Classless Inter-Domain Routing (CIDR).
- Created a new set of standards that allowed service providers to allocate IPv4 addresses on any address bit boundary (prefix length) instead of only by a class A,B, or C address.
- Classless addressing is possible with the help of subnetting.
- Valid Subnet Masks
   Subnet</br>Value | 128 | 64 | 32 | 16 |  8 |  4 |  2 |  1
  ------------------|-----|----|----|----|----|----|----|----
    255             |  1  |  1 |  1 |  1 |  1 |  1 |  1 |  1
    254             |  1  |  1 |  1 |  1 |  1 |  1 |  1 |  0
    252             |  1  |  1 |  1 |  1 |  1 |  1 |  0 |  0
    248             |  1  |  1 |  1 |  1 |  1 |  0 |  0 |  0
    240             |  1  |  1 |  1 |  1 |  0 |  0 |  0 |  0
    224             |  1  |  1 |  1 |  0 |  0 |  0 |  0 |  0
    192             |  1  |  1 |  0 |  0 |  0 |  0 |  0 |  0
    128             |  1  |  0 |  0 |  0 |  0 |  0 |  0 |  0
    0               |  0  |  0 |  0 |  0 |  0 |  0 |  0 |  0

   /n | Mask      | /n  | Mask        | /n  | Mask          | /n  | Mask
  ----|-----------|-----|-------------|-----|---------------|-----|----------------
   /1 | 128.0.0.0 | /9  | 255.128.0.0 | /17 | 255.255.128.0 | /25 | 255.255.255.128
   /2 | 192.0.0.0 | /10 | 255.192.0.0 | /18 | 255.255.192.0 | /26 | 255.255.255.192
   /3 | 224.0.0.0 | /11 | 255.224.0.0 | /19 | 255.255.224.0 | /27 | 255.255.255.224
   /4 | 240.0.0.0 | /12 | 255.240.0.0 | /20 | 255.255.240.0 | /28 | 255.255.255.240
   /5 | 248.0.0.0 | /13 | 255.248.0.0 | /21 | 255.255.248.0 | /29 | 255.255.255.248
   /6 | 252.0.0.0 | /14 | 255.252.0.0 | /22 | 255.255.252.0 | /30 | 255.255.255.252
   /7 | 254.0.0.0 | /15 | 255.254.0.0 | /23 | 255.255.254.0 | /31 | 255.255.255.254
   /8 |*255.0.0.0*| /16 |*255.255.0.0*| /24 |*255.255.255.0*| /32 |*255.255.255.255*

### Subnetting

- A subnetwork or subnet is a logical subdivision of an IP network.
- The practice of dividing a network into two or more network is called subnetting.
- Computers that belong to a subnet are addressed with an identical most-significant bit-group in their IP addresses.
- Steps for subnetting
  1. Identify the class of the IP address and note the Default Subnet Mask.
  2. Convert the Default Subnet Mask into Binary.
  3. Note the number of hosts required per subnet and find the Subnet Generator (SG) and octet position.
  4. Generate the new subnet mask.
  5. Use the SG and generate the network ranges (subnets) in the appropriate octet position.

- FLSM = Fixed Length Subnet Masking
- VLSM = Variable Length Subnet Masking

## Network Layer Protocol

### Address Resolution Protocol (ARP)

- Different Address for Communication
  - Transport Layer
    - Protocols - TCP/UDP
    - Port Numbers is of 16 bits (0 - 65535).
      - Well known Ports (0 - 1023).
      - Registered Ports (1024 - 49151).
      - Dynamic or Private Ports (49152 - 65535).
      - Example: HTTP - 80.

  - Network Layer
    - Protocols DNS.
    - IP Address (IPv4 or IPv6)
      - IPv4 - 32 bits (Decimal)
      - IPv6 - 128 bits (Hexadecimal)
    - Either user provides the IP address or DNS resolves the names into IP address.

  - Data Link Layer
    - Mac Address
    - 48 bits (hexadecimal) - assigned by manufacturer.
    - ARP protocol
      - The ARP protocol provides two basic functions:
        1. Resolving IPv4 addresses to MAC addresses.
        2. Maintaining a table of mappings.
      - ARP request -> broadcast message.
      - ARP reply -> unicast message.

- ARP: Map IP address into physical addresses.
- Table of IP to physical address bindings.
- Broadcast request if IP address not in table.
- The broadcast address: MAC address.
- Target machine responds (unicast) with its physical address.
- Table entries are discarded if not refreshed.

- ARP header format

  ```[]
  0                8                  16                                 31
  +-----------------------------------+-----------------------------------+
  |       Hardware type = 1           |     ProtocolType = 0x0800         |
  +----------------+------------------+-----------------------------------+
  |   HLen = 48    |    PLen = 32     |            Operation              |
  +----------------+------------------+-----------------------------------+
  |                Source Hardware Address (bytes 0 - 3)                  |
  +-----------------------------------+-----------------------------------+
  | SourceHardwareAddress (bytes 4-5) | SourceProtocolAddress (bytes 0-1) |
  +-----------------------------------+-----------------------------------+
  | SourceProtocolAddress (bytes 2-3) | TargetHardwareAddress (bytes 0-1) |
  +-----------------------------------+-----------------------------------+
  |                Target Hardware Address (bytes 2-5)                    |
  +-----------------------------------------------------------------------+
  |                Target Protocol Address (bytes 0-3)                    |
  +-----------------------------------------------------------------------+
  ```

  - Hardware Type: Type of physical network (e.g, Ethernet)
  - Protocol Type: Type of upper layer protocol (e.g, IP)
  - HLen and PLen: Length of physical address and protocol address.
  - Operation : Request or reply.

- Reverse Address Resolution Protocol (RARP)
  - ARP: Maps IP address to Physical Address.
  - Reverse ARP (RARP) is an obsolete computer networking protocol used by a client computer to request its Internet Protocol (IPv4) address from a computer network, when all it has available is its link layer or hardware address, such as a MAC address.
  - This protocol can use the known MAC address to retrieve its IP address. Functionality wise, RARP is complete opposite of the ARP.
  - It is possible for a device to not know its own IP address. This may happen if, for example, the device could not save the IP address because there was insufficient memory available. In such cases, the Reverse ARP is used.
  - It has been rendered obsolete by the Bootstrap Protocol (BOOTP) and the modern Dynamic Host Configuration Protocol (DHCP), which both support a much greater feature set than RARP.
  - The RARP cannot handle subnetting because no subnet masks are sent. If multiple subnets are deployed, an RARP server must be available in each subnet.

### Dynamic Host Configuration Protocol (DHCP)

- The MAC addresses are configured into network by manufacturer and they are expected to be unique.
- IP addresses must be unique on any internetwork.
- Most Operating Systems provide a way to manually configure the IP information for the host.
- Drawbacks of manual configuration:
  - A lot of work to configure all the hosts in a large network.
  - Configuration process is error-prune.
- Hence automated IP configuration process is required.
- DHCP server is responsible for providing configuration information to hosts.
- There is at least once DHCP server for an administration domain.
- DHCP server maintains a pool of available IP addresses.
- So when requested by a host, DHCP allows the host to obtain an IP address dynamically.
- DHCP "leases" the IP information to the host for a set period.

- Methods of IP address allocation
  - Depending on implementation, the DHCP server may have three methods of allocating IP addresses.
    - Dynamic allocation
    - Automatic allocation
    - Static allocation

- DHCP Packet Format

  ```[]
    0                8               16                24              31
    +----------------+---------------+-----------------+----------------+
    | Operation code | Hardware type | Hardware length | Hop count      |
    +----------------+---------------+-----------------+----------------+
    |                       Transaction ID                              |
    +--------------------------------+----------------------------------+
    |       Number of seconds        |            Flags                 |
    +--------------------------------+----------------------------------+
    |                       Client IP address                           |
    +-------------------------------------------------------------------+
    |                         Your IP address                           |
    +-------------------------------------------------------------------+
    |                       Server IP address                           |
    +-------------------------------------------------------------------+
    |                       Gateway IP address                          |
    +-------------------------------------------------------------------+
    |                Client hardware address (16 bytes)                 |
    +-------------------------------------------------------------------+
    |                      Server name (64 bytes)                       |
    +-------------------------------------------------------------------+
    |                     Boot file name (128 bytes)                    |
    +-------------------------------------------------------------------+
    |                     Options (variable length)                     |
    +-------------------------------------------------------------------+
  ```

  - Options for DHCP

    Tag   | Length    | Value         | Description
    ------|-----------|---------------|----------------------
    0     |           |               | Padding
    1     | 4         | Subnet mask   | Subnet mask
    2     | 4         |Time of the day| Time offset
    3     | Variable  | IP addresses  | Default router
    4     | Variable  | IP addresses  | Time saver
    5     | Variable  | IP addresses  |IEN 16 server
    6     | Variable  | IP addresses  | DNS server
    7     | Variable  | IP addresses  | Log server
    8     | Variable  | IP addresses  | Quote server
    9     | Variable  | IP addresses  | Print Server
    10    | Variable  | IP addresses  | Impress
    11    | Variable  | IP addresses  | RLP server
    12    | Variable  | IP addresses  | Host name
    13    | 2         | DNS name      | Boot file size
    53    | 1         |               | Used for dynamic configuration
    128-254| Variable |Specific info. | Vendor specific
    255   |           |               | End of list

    ```[]
                                 |--> 1 DHCP DISCOVER
      Tag    Length   Value      |--> 2 DHCP OFFER
    +------+--------+--------+   |--> 3 DHCP REQUEST
    |  53  |   1    |    *---|---|--> 4 DHCP DECLINE
    +------+--------+--------+   |--> 5 DHCP ACK
                                 |--> 6 DHCP NACK
                                 |--> 7 DHCP RELEASE
                                 |--> 8 DHCP INFORM
    ```

- DHCP Operation

  ```[]
                                         ________
   +----+      -- DHCP DISCOVER -->     /______/ |
   |    |     <-- DHCP OFFER --         | [==] | |
   +----+      -- DHCP REQUEST -->      |------| |
  __|__|__     <-- DHCP ACK  --         |______|/
  DHCP Client                           DHCP Server
  ```

  - DHCP DISCOVER:
    - The DHCP client broadcasts a DHCP DISCOVER message on the network subnet using the destination address 255.255.255.255 (limited broadcast) or the specific subnet broadcast address (direct broadcast) DHCP Client
    - A DHCP client may also request its last known IP address.
  - DHCP OFFER:
    - When a DHCP server receives a DHCP DISCOVER message from a client, which is an IP address lease request, THE DHCP server reserves an IP address for the client and makes a lease offer by sending a DHCP OFFER message to the client.
    - This message contains the client's client id (traditionally a MAC address), the IP address that the server is offering, the subnet mask, the lease duration, and the IP address of the DHCP server making the offer.
  - DHCP REQUEST:
    - In response to the DHCP offers, the client replies with DHCP REQUEST message, broadcast to the server, requesting the offered address.
    - A client can receive DHCP offers from multiple servers, but it will accept only one DHCP offer.
    - Based on the required server identification option in the request and broadcast messaging, servers are informed whose offer the client has accepted.
  - DHCP ACK:
    - When the DHCP server receives the DHCP REQUEST message from the client, the configuration process enters its final phase.
    - The acknowledgement phase involves sending a DHCP ACK packet to the client.
    - This packet includes the lease duration and any other configuration information that the client might have requested.
    - At this point, the IP configuration process is completed.

### Internet Control Message Protocol (ICMPv4)

- ICMP is a supporting protocol in the Internet protocol suite.
- It is a supporting protocol in the Internet protocol suite.
- It is used by network devices, including routers, to send error messages and operational information indicating success or failure when communicating with another IP address.
- Examples:
  - Destination host unreachable due to link/node failure.
  - Reassembly process failed
  - TTL had reached 0 (so datagrams don't cycle forever)
  - IP header checksum failed.
- ICMP messages are typically used for diagnostic or control purposes or generated in response to errors in IP operations.
- ICMP errors are directed to the source IP address of the originating packet.
- This protocol defines a collection of error messages that are sent back to the source host whenever a router or host is unable to process an IP packet successfully.
- ICMP-Redirect
  - From router to a source host.
  - With a better route information.
- ICMPv4 Packet Format

  ```[]
  |<--8 bits-->|<--8 bits-->|<--8 bits-->|<--8 bits-->|
  |   Type     |   Code     |         Checksum        |
  +------------+------------+-------------------------+
  |               Rest of the Header                  |
  +---------------------------------------------------+
  |                  Data Section                     |
  +---------------------------------------------------+
  ```

### Internet Protocol (IPv4)

- Need for Network layer
  - It is responsible for delivery of data from the original source to the destination network.
  - Service provided by the network layer.
    - Logical addressing
    - Routing

- Internet Protocol (IP)
  - Switching at the network layer in the internet uses the datagram approach to packet switching.
  - Communication at the network layer in the internet is connectionless.
  - The Internet Protocol version 4 (IPv4) is the delivery mechanism used by the TCP/IP protocols.
  - Best-effort delivery (unreliable service).
    - Packets are lost.
    - Packets are delivery out of order
    - Duplicate copies of a packet are delivered.
    - Packet can be delayed for a long time.
  
- IPv4 Datagram Format

  ```[]
                        |<----------20-65536 bytes--------->|
                        |<--20-60bytes-->|                  |
                        +----------------+------------------+
                  <-----|     Header     |      Data        |
                        +----------------+------------------+
                      /                    \
                  /                            \
              /                                    \
          /                                            \
      /                                                    \
  +--------+--------+-------------+-------------------------------+
  |  VER   | HLEN   |   Service   |       Total length            |
  | 4 bits | 4 bits |   8 bits    |          16 bits              |
  +--------+--------+-------------+--------+----------------------+
  |       Identification          | Flags  | Fragmentation offset |
  |        16 bits                | 3 bits |      13 bits         |
  +-----------------+-------------+--------+----------------------+
  |  Time to live   |   Protocol  |         Header checksum       |
  |     8 bits      |   8 bits    |         16 bits               |
  +-----------------+-------------+-------------------------------+
  |                      Source IP address                        |
  +---------------------------------------------------------------+
  |                    Destination IP address                     |
  +---------------------------------------------------------------+
  |                          Option                               |
  +---------------------------------------------------------------+
  |                       DATA (variable)                         |
  +---------------------------------------------------------------+
  |<--------------------------32 bits---------------------------->|
  ```

  - Version - 4 bits
    - Ver = 0100 (Decimal: 4) means it is IPv4.
  - HLEN - 4 bits (header length)
    - HLEN = Number of 32 bit words in the header.
    - If HLEN = 6 (0110), it means the IP header is 192 bits (32 x 6) long.
  - Service - 8 bits (Service bits)
    - Type of Service (TOS)
    - Not widely used
      TOS Bits | Description
      ---------|---------------
       0000    | Normal (default)
       0001    | Minimize cost
       0010    | Maximized reliability
       0100    | Maximize throughput
       1000    | Minimize delay
  - Total length - 16 bits
    - Number of bytes in this datagram.
    - This field defines the total length of the datagram including the header.
  - Identification - 16 bits
    - used by fragmentation.
  - Flags (3 bits) / Fragmentation offset (13 bits)
    - Used by fragmentation
    - D - Do not fragmentation & M - More fragmentation
  - Time to Live - 8 bits (TTL)
    - Number of hoops this datagram has traveled.
    - Prevents looping of IP packets in the network.
  - Protocol - 8 bits
    - Demux Key (TCP =6, UDP=17)
    - The value of the protocol field defines to which protocol that data belong.
      Value  | Protocol
      -------|----------
       1     | ICMP
       2     | IGMP
       6     | TCP
       17    | UDP
       89    | OSPF
  - Header Checksum - 16 bits
    - Used for Error Detection
  - Options, data and padding are used to make a complete packet.

- Time to Live (TTL)
  - Number of hops this datagram has traveled.
  - Prevent looping of IP packet in the network.
  - In the IPv4 header. TTL is the 9th octet of 20.
  - In the IPv6 header, it is the 8th octet of 40.
  - The maximum TTL value is 255, the maximum value of a single octet.
  - A recommended initial TTL value is 64.
  - The time-to-live value can be thought of as an upper bound on the time that an IP datagram can exist in an internet system.
  - The TTL field is set by the sender of the datagram, and reduced by every router on the route to its destination.
  - If the TTL field reaches zero before the datagram arrives at its destination, then the datagram is discarded and an ICMP error datagram (11-Time Exceeded) is sent back to the sender.
  - The purpose of the TTL field is to avoid looping of IP packets in the internet.
  - In theory, under IPv4, time to live is measured in seconds, although every host that passes the datagram must reduce the TTL by at least one unit.
  - In practice, the TTL field is reduced by one on every hop.
  - To reflect this practice, the field is renamed hop limit in IPv6.

### Fragmentation in IPv4

- A datagram can travel through different networks.
- Each router decapsulates the IPv4 datagram from the frame it receive, processes it, and then encapsulates it in another frame.
- The format and size of the received frame depend on the protocol used by the physical network through which the frame has just traveled.
- The format and size of the sent frame depends on the protocol used by the physical network through which the frame is going to travel.
- For example, if a router connects a LAN to a WAN, it receives a frame in the LAN format and sends a frame in the WAN format.
- Each data link layer protocol has its own format in most protocols.
- One of the field defined in the format is the maximum size of the data field.
- In other words, when a datagram is encapsulated in a frame, the total size of the datagram must be less than this maximum size, which is defined by the restrictions imposed by the hardware and software used in the network.
- To make the IPv4 protocol independent of the physical network, the designers decided to make the maximum length of the the IPv4 datagram equal to 65535 bytes.
- This makes transmission more efficient if we use a protocol with an MTU (maximum transmission unit) of this size.
- However, for other physical networks, we must divide the datagram to make it possible to pass through these networks. This is called fragmentation.
- The source usually does not fragment the IPv4 packet. The transport layer will instead segment the data into a size that can be accommodated by IPv4 and the data link layer in use.

- The value of the MTU depends on the physical network protocol.
   Protocol             | MTU
  ----------------------|-------
   Hyperchannel         | 65535
   Token Ring (16 Mbps) | 17914
   Token Ring (4 Mbps)  | 4464
   FDDI                 | 4352
   Ethernet             | 1500
   X.25                 | 576
   PPP                  | 296

- When a datagram is fragmented, each fragment has its own header with most of the fields repeated, but with some changed.
- A fragmented data may itself be fragmented if it encounters a network with an even smaller MTU.
- In other words, a datagram can be fragmented several times before it reaches the final destination.
- In IPv4, fragmentation can be done by source host or any router. The reassembly is done only at the destination.
- It is logical to do the reassembly at the final destination.
- When a datagram is fragmented, required ports of the header must be copied by all fragments
  - Flags,
  - Fragmentation offset and
  - Total length.
- The rest of the field must be copied.
- Of course, the value of the checksum must be recalculated regardless of fragmentation.
- The field that are related to fragmentation and reassembly of an IPv4 datagram are the
  - Identification
    - This 16-bit identifies a datagram originating from the source host.
    - The combination of the identification and source IPv4 must uniquely define a datagram as it leaves the source host.
    - To guarantee uniqueness, the IPv4 protocol uses a counter to label the datagrams.
    - The counter is initialized to a positive number.
    - When the IPv4 protocol sends a datagram, it copies the current value of the counter to the identification and increments the counter by 1.
    - As long as the counter is kept in the main memory, uniqueness is guaranteed.
    - When a datagram is fragmentation, the value in the identification field is copied to all fragments
    - In other words, all fragments have the same identification number, the same as the original datagram.
    - The identification number helps the destination is reassembling the datagram.
    - It knows that all fragments having the same identification value must be assembled into one datagram.
  - flags
    - This is a 3-bit field. The first bit is reserved.
    - The second bit is called the do not fragment bit.
    - If its value is 1, the machine must not fragment the datagram.
    - If it cannot pass the datagram through any available physical network, it discards the datagram and sends an ICMP error messages to the source host.
    - If its value is 0, the datagram can be fragmented if necessary
    - The third bit is called the fragment bit.
    - If its value is 1, it means the datagram is not the last fragment, there are more fragment after this one.
    - If its value is 0, it means this is the last or only fragment
  - fragmentation offset
    - This 13-bit field shows the relative position of this fragment with respect to the whole datagram.
    - It is the offset of the data in the datagram measured in units of 8 bytes.
    - This is done because the length of the offset field is only 13 bits and cannot represent a sequence by bytes greater than 8191.
    - This forces hosts or router that fragment datagrams to choose a fragment size so that the first byte number is divisible by 8.

### Internet Group Management Protocol (IGMP)

- It is a network layer protocol.
- The Internet Group Management Protocol (IGMP) is a communication protocol used by hosts and adjacent routers on IPv4 networks to establish group memberships.
- IGMP is an integral part of IP multicast.
- It can be used for one-to-many networking applications such as online streaming video and gaming, and allows more efficient use of resources when supporting these types of applications.

```[]
  +----+                                                         +-----+
  | __ |----------(x)------------(x)-------------[====]----------|     |
  | == |        Router 1     Local Multicast    L2 switch        +-----+
  +----+           |            Router           with IGMP        =====
    |              |              |              Snooping         Video 
  Video            |              |                |              Client
  server           |              |                |                |
    |              |<----PIM----->|<-----IGMP----->|<-----IGMP----->|
    |              |              |                |                |
    |______________|___UDP/RTP____|________________|________________|
                Multicast Traffic |<------------LAN---------------->|
```

- IGMP operates between a host and a local multicast router.
- Switching feature IGMP snooping derive useful information by observing these IGMP transactions.
- Protocol Independent Multicast (PIM) is then used between the local and remote multicast routers, to direct multicast traffic from hosts sending multicasts to hosts that have registered through to receive them.
- Messages
  - General membership queries: Sent by multicast routers to determine which multicast addresses are of interest to systems attached to the network(s) they serve to refresh the group membership state for all systems on its network.
  - Group-specific membership queries: Used for determining the reception state for a particular multicast address.
  - Group-and-source-specific queries: Allow the router to determine if any systems desire reception of messages sent to multicast group from a source address specified in a list of unicast addresses.
  - Membership reports: Sent by multicast receivers in response to a membership query or asynchronously when first registering for a group.
  - Leave group messages: Sent by multicast receivers when specified multicast transmissions are no longer needed at the receiver.

## Routing Protocols

### Basics of Routing

- The router is responsible for routing of traffic between networks.
- Routers are specialized computers containing the following required components to operate: Central processing unit (CPU), Operating system (OS), Memory and storage (RAM, ROM, NVRAM, Flash, hard drive) etc.
- Routers can connect multiple networks.
- Routers have multiple interfaces, each on a different IP network.
- Routers choose the best path.
- Routers use routing tables to determine the best path to send packets.
- Routers encapsulate the packet and forward it to the interface indicated in routing table.
- Forwarding table
  - Used when a packet is being forwarded and so must contain enough information to accomplish the forwarding function.
  - A row in the forwarding table contains the mapping from a network number to an outgoing  interface and some MAC information, such as Ethernet Address of the next hop.
- Routing table
  - Built by the routing algorithm as a precursor to build the forwarding table.
  - Generally contains mapping from network numbers to next hops.
- Best path
  - Best path is selected by a routing protocol based on the value or metric uses to determine the distance to reach a network
  - A metric is the value used to measure the distance to a given network.
  - Best path to a network is the path with the lowest metric.

### Static Routing Vs dynamic Routing

- Static Routing
  - A static routing table is created, maintained, and updated by a network administration, manually.
  - A static route to every network must be configured on every for full connectivity.
  - This provides a granular level of control over routing, but quickly becomes impractical on large networks.
  - Routers will not share static routes with each other, thus reducing CPU/RAM overhead and saving bandwidth.
  - However, static routing is not fault-tolerant, as any change to the routing infrastructure (such as a link going down, or a new network added) requires manual intervention.
  - Router operating in a purely static environment cannot seamlessly choose a better route if a link becomes unavailable.

- Dynamic Routing
  - A dynamic routing table is created, maintained and updated by a routing protocol running on the router.
  - The choice of the "best route" is the hands of the routing protocol and not the network administrator.
  - Example of routing protocols: RIP (Routing Information Protocol), OSPF (Open Shortest Path First) and EIGRP (Enhanced Interior Gateway Routing Protocol).
  - Routers do share dynamic routing information with each other, which increases CPU, RAM and bandwidth usage.
  - However, routing protocols are capable of dynamically choosing a different (or better) path when there is a change to the routing infrastructure.

### Dynamic Routing Protocols

- A static approach has several shortcomings:
  - It does not deal with node or link failures.
  - It does not consider the addition of new nodes or links.
  - It implies that edge costs cannot change.
- Solution
  - Need a distributed and dynamic protocol
  - Two main classes of protocols
    - Distance Vector
    - Link State

- Dynamic Routing Protocol
  - A routing table can be either static or dynamic.
  - A static table is one with manual entries.
  - A routing table is one that is updated automatically when there is a change somewhere in the Internet.
  - A routing protocol is a combination of rules and procedures that lets routers in the Internet inform each other of changes.

- Popular Routing Protocols
  - Intradomain
    - Distance Vector Ex: Routing Information Protocol (RIP)
    - Link State Ex: Open shortest Path First Protocol (OSPF)
  - Interdomain
    - Path Vector Ex: Border Gateway Protocol (BGP)

### Distance Vector Routing

- Each node constructs a one dimensional array (a vector) containing the "distances" (costs) to all other nodes and distributes that vector to its immediate neighbors.
- Starting assumption is that each node knows the cost of the link to each of its directly connected neighbors.
- The distance vector routing algorithm is sometimes called as Bellman-Ford algorithm.
- Every T seconds each router sends its table to its neighbor and each router then updates its table based on the new information.
- Problems include fast response to good news and slow response to bad news.
- Also too many messages to update.
- Routing Table Entries: (Destination, Distance/cost, next hop)
  - Node A: (B,1,B),(C,1,C),(F,1,F),(E,1,E),(D,2,C) etc.

- Problems in DVR
  - Count-to-infinity problem in DVR.
    - The count-to-infinity problem occurred due to routing loops from the Distance Vector Routing Protocol because it uses the Bellman-Ford algorithm and cannot prevent routing loops. Routing loops in the network can occur due to failure of the interface or link between two routers in the network.

- Solution
  - Split Horizon
    - In computer networking split-horizon route advertisement is a method of preventing  routing loops in distance-vector routing protocols by prohibiting a router from advertising a route back onto the interface from which it was learned.
    - In other words it is a method of preventing a routing loop in a network.
    - *The basic principle is simple:* Information about the routing for a particular packet is never sent back in the direction from which it was received.
    - With the split-horizon rule in place, this particular loop scenario cannot happen, improving convergence time in complex, highly-redundant environments.
  - Split Horizon with Poison Reverse
    - Poison Reverse is an implementation algorithm that iis often used within distance-vector routing.
    - The use of poison reverse is to solve the count-to-infinity problem.
    - Practically, poison reverse can be thought of as the reverse of split horizon.
    - With poison reverse, route advertisements that would be suppressed by split horizon are instead advertised with a distance of infinity.

### Routing Information Protocol (RIP)

- Its not used nowadays.
- It is one of the oldest distance-vector routing which employs the hop count as a routing metric.
- RIP prevents routing loops by implementing a limit on the number of hops allowed in a path from source to destination.
- The largest number of hops allowed for RIP is 15, which limits the size of networks that RIP can support.

- RIP Versions
  - RIPv1
    - When starting up, every 30 seconds thereafter, a routing with RIPv1 implementation broadcasts to 255.255.255.255 a request message through every RIPv1 enable interface.
    - RIPv1 enabled router not only request the routing table of other routers every 30 seconds, they also listen to incoming request from neighboring routers and send their own routing table in turn.
    - RIPv1 uses classful routing.
    - The periodic routing updates do not carry subnet information, lacking support for variable length subnet masks (VLSM).
    - This limitation makes it impossible to have different-sized subnets inside of the same network class. There is also no support for router authentication, making RIP vulnerable to various attacks.
  - RIPv2
    - It included the ability to carry subnet information thus supporting Classless Inter-Domain Routing (CIDR).
    - To maintain backward compatibility, so the hop count limit remained 15.
    - In an effort to avoid unnecessary load on hosts that do not participate in routing, RIPv2 multicasts the entire routing table to all adjacent routers at the 224.0.0.9, as opposed to RIPv1 which uses broadcast.
    - Unicast addressing is still allowed for special applications.
    - In RIPv2, MD5 authentication was introduced.
    - Route tags were also added in RIPv2. This functionality allows a distinction between routes learned from the RIP protocol and routes learned other protocols.
  - RIPng
    - ng = Next Generation.
    - It is an extension of RIPv2 for support of IPv6 the next generation Internet Protocol.
    - The main differences between RIPv2 and RIPng are:
      - Support of IPv6 networking.
      - While RIPv2 supports authentication ,RIPng does not. IPv6 routers were, at the time, supposed to use IPsec for authentication.
      - RIPv2 encoding the next-hop into each route entry, RIPng requires specific encoding of the next hop for route entries.
      - RIPng sends updates on UDP port 521 using the multicast group FF02::9.

   RIPv1  | RIPv2 | RIPng
  --------|-------|--------
  Updates are broadcast | Updates are multicast | Updates are multicast
  Broadcast Address:</br>255.255.255.255.255 | Multicast Address:</br>224.0.0.9 | Multicast at FF02::9 (RIPng can only run on IPv6 networks)
  Supports IPV4 | Supports IPv4 | Supports IPv6
  No Authentication | Supports Authentication | Routers with IPSec Authentication
  Classful Addressing | VLSM | Classless updates are sent

- Timers used
  - Update Timer
  - Invalid Timer (Expiration Timer)
  - Flush Timer
  - Hold-down Timer

- The RIP HOP count
  - The routing metric used by RIP counts the number of routers that need to be passed to reach a destination IP network.
  - The hop count 0 denotes a network that is directly connected to the router.
  - 16 hops denote a network that is unreachable, according to the RIP hop limit.

- Limitations of RIP
  - The hop count cannot exceed 15, or routes will be dropped.
  - Variable Length Subnet Masks are not supported by RIP version 1 (which is obsolete).
  - RIP has slow convergence and count to infinity problems.

- RIP Messages
  - RIP defined two types of messages:
    - *Request Message*: Asking a neighboring RIPv1 enabled router to send its routing table.
    - *Response Message*: Carries the routing table of a router.

- RIP Packet Format

  ```[]
  0          8         16                    31
  +----------+----------+---------------------+
  | Commands | Version  |    Must be zero     |
  +----------+----------+---------------------+
  |Family of Net 1(AFI) |    Must be zero     |
  +---------------------+---------------------+
  |          IP Address of Network 1          |
  +-------------------------------------------+
  |                Must be Zero               |
  +-------------------------------------------+
  |                Must be Zero               |
  +-------------------------------------------+
  |             Distance to Net 1             |
  +---------------------+---------------------+
  |Family of Net 2(AFI) |    Must be zero     |
  +---------------------+---------------------+
  |          IP Address of Network 2          |
  +-------------------------------------------+
  |                Must be Zero               |
  +-------------------------------------------+
  |                Must be Zero               |
  +-------------------------------------------+
  |             Distance to Net 2             |
  +-------------------------------------------+
  ```

  - Command: Indicate whether the packet is a request or a response.
  - Version: Specifies the RIP version which can signal different potentially incompatible version
  - Zero: This field is not actually used by RFC 1058 RIP, it was added solely to provide backward compatibility with prestandard varieties of RIP.Its name comes from its defaulted value: zero
  - Address-family identifier (AFI): Specifies the address family used. RIP is designed to carry routing information for several different protocols. Each entry has an address family identifier to indicate the type of address being specified. The AFI for IP is 2.
  - Address: Specifies the IP address for the entry.
  - Metric (distance to net): Indicates how many internetwork hops (routers) have been traversed in the trip to the destination. This value is between 1 and 15 for a valid route, or 16 for an unreachable route.
